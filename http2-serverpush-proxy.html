<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Reverse proxy that helps to automatically utilize HTTP/2.0's server push mechanism for static websites. Available as middleware and standalone application."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a><ul class="navigation-list float-right"><li class="navigation-item"><a class="navigation-link" href="https://github.com/leviwheatcroft/selfhosted-awesome-unlist"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>github</a></li></ul></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>http2-serverpush-proxy</h1><span class="subheading"></span><div class="links"><a class="button button-outline" href="https://github.com/n1try/http2-serverpush-proxy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>http2-serverpush-proxy</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info"><div class="github"><span class="pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>18 Nov 2016</span><span class="stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>23</span><span class="issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>0</span></div><div class="tags"><a class="button" href="/selfhosted-awesome-unlist/tags/javascript.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>JavaScript</a><a class="button" href="/selfhosted-awesome-unlist/tags/proxy.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Proxy</a><a class="button" href="/selfhosted-awesome-unlist/tags/selfhosted.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>selfhosted</a></div></div></div></div></div></section><article><div class="container"><div class="row"><div class="column"><h1 id="http2-serverpush-proxy">http2-serverpush-proxy</h1>
<p>This is a reverse proxy that helps you to automatically make use of HTTP/2.0&#39;s <a href="http://blog.xebia.com/http2-server-push/">server push</a> mechanism for your static websites.</p>
<p><a href="https://nodei.co/npm/http2-serverpush-proxy/"><img src="https://nodei.co/npm/http2-serverpush-proxy.png?downloads=true&downloadRank=true&stars=true" alt="NPM"></a></p>
<h2 id="how-it-works">How it works</h2>
<p>Usually, websites consist of multiple assets, like CSS and JS files as well as images like PNGs, JPGs and SVGs. Traditionally, a user&#39;s browser fetches the HTML first, parses it and then downloads all linked assets. However, this is slow, since the assets can&#39;t be loaded before the HTML is completely fetched and parsed. With server push, your webserver can actively sends those assets to the client browser even before it requested them. To prevent you from having to implement this functionality, <em>http2-serverpush-proxy</em> sits as a proxy between your actual webserver and the user. In contrast to some other approaches like <a href="https://github.com/GoogleChrome/http2-push-manifest">http2-push-manifest</a>, where the assets to be pushed are declared statically, this library <strong>dynamically parses the HTML</strong> files and extracts contained asset that should be pushed.</p>
<p><img src="https://anchr.io/i/XEitW.png" alt="">
Without server push
<img src="https://anchr.io/i/AOisH.png" alt="">
With server push</p>
<h2 id="usage">Usage</h2>
<h3 id="standalone">Standalone</h3>
<p>One way to use this is as a standalone proxy by installing it globally with <code>npm install -g http2-serverpush-proxy</code></p>
<pre><code class="language-bash">$ serverpush-proxy --extensions=css,js,svg --target=http://localhost:8080 --key=./certs/dev-key.pem --cert=./certs/dev-cert.pem --port 3000</code></pre>
<h4 id="options">Options</h4>
<ul>
<li><code>--target</code> <strong>[required]</strong>: The target URL to be proxied. E.g. if your website runs at <em><a href="http://localhost:8080">http://localhost:8080</a></em>, this would be your target URL. </li>
<li><code>--extensions</code>: File extensions to be push candidates Defaults to: see <a href="#what-is-pushed">this section</a></li>
<li><code>--key</code> <strong>[required]</strong>: Path to your SSL key (HTTP/2 requires TLS (HTTPS) encryption) .</li>
<li><code>--cert</code> <strong>[required]</strong>:  Path to your SSL certificate.</li>
<li><code>--port</code>: Port to make the proxy listen on. Defaults to <code>8080</code>.</li>
</ul>
<h3 id="embedded-connect-middleware">Embedded (connect middleware)</h3>
<p>You can also use this library as <a href="https://www.npmjs.com/package/connect">connect</a> middleware in your application. You need a webserver running with <a href="https://www.npmjs.com/package/spdy">node-spdy</a> (you need HTTP/2!). Please not that currently this middleware must be <strong>the last one in your stack</strong>, since it calls <code>res.end()</code>.</p>
<h4 id="example">Example</h4>
<pre><code class="language-javascript">const pushMiddleware = require(&#39;http2-serverpush-proxy&#39;)({ baseUrl: &#39;http://localhost:8080&#39; })
    , app = require(&#39;express&#39;)()
    , http = require(&#39;spdy&#39;)
    , fs = require(&#39;fs&#39;);

app.use(&#39;/static&#39;, pushMiddleware.proxy);
app.use(&#39;/static&#39;, pushMiddleware.push);
app.get(&#39;/&#39;, (req, res) =&gt; {
    res.send(&#39;It works!&#39;);
});

const spdyOpts = {
    key: fs.readFileSync(__dirname + &#39;/certs/dev-key.pem&#39;),
    cert: fs.readFileSync(__dirname + &#39;/certs/dev-cert.pem&#39;),
    spdy: {
        protocols: [&#39;h2&#39;, &#39;spdy/3.1&#39;, &#39;http/1.1&#39;],
        plain: false,
        &#39;x-forwarded-for&#39;: true,
    }
};

http.createServer(spdyOpts, app).listen(8081);</code></pre>
<p>This would spawn an Express webserver, where all requests to <code>/static</code> are proxied to <code>http://localhost:8080</code> and all HTML (<code>Content-Type: text/html</code>) responses are parsed for assets to get server-pushed.</p>
<h4 id="options-1">Options</h4>
<p>Instantiating the middleware happens through calling a function (see line 1) that receives a config object with following parameters.</p>
<ul>
<li><code>baseUrl</code> <strong>[required]</strong>: The target URL to be proxied. E.g. if your website runs at <em><a href="http://localhost:8080">http://localhost:8080</a></em>, this would be your target URL. </li>
<li><code>extensions</code> <strong>[optional]</strong>: File extensions to be push candidates Defaults to: see <a href="#what-is-pushed">this section</a></li>
</ul>
<h2 id="what-is-pushed">What is pushed?</h2>
<p>Currently, <code>&lt;img src=&quot;...&quot;</code>, <code>&lt;script src=&quot;...&quot;</code> and <code>&lt;link href=&quot;...&quot;</code> attributes are parsed when looking for assets. Supported file types to be pushed include <code>css</code>, <code>js</code>, <code>png</code>, <code>jpg</code>, <code>gif</code> and , <code>svg</code>.</p>
<p>Non-GET requests as well as requests, which don&#39;t <code>Accept</code> HTML are directly piped to and from the proxy. GET requests, which accept HTML (<code>text/html</code>, <code>text/*</code>, <code>*/*</code>) are fetched by the proxy first. If <code>Content-Type</code> doesn&#39;t equal <code>text/html</code>, they&#39;re written to the response. Otherwise the HTML response body (the one from the proxied server) is parsed, assets are fetched and pushed and finally the HTML payload is also written to the response.</p>
<h2 id="constraints">Constraints</h2>
<ul>
<li>The proxied server mustn&#39;t use encryption (no HTTPS)</li>
<li>The proxied server mustn&#39;t use compression (no <code>Content-Encoding</code>). <code>Accept-Encoding</code> headers are removed from any request.</li>
<li>The proxied server musn&#39;t require authentication</li>
<li>The proxy only listens for HTTPS connections. If you want to support &quot;upgrading&quot; an <em>http://</em> request to <em>https://</em>, you&#39;d need another proxy (like nginx) to do that redirect.</li>
</ul>
<h2 id="what-doesnt-work--todo">What doesn&#39;t work / Todo</h2>
<p>This library is not completely finished, yet. Consequently it still lacks of some useful features, which should be implemented some time. </p>
<ul>
<li>Support for <strong>Websockets</strong></li>
<li>Support for HTTP <strong>authentication</strong></li>
<li>Also push dynamically included HTML (<strong>WebComponents</strong>, ng-include, ...)</li>
<li>Support for <strong>compression</strong> (gzip, deflate)</li>
<li>Avoid this from having to be the very last middleware step, but support <strong>further middleware after it</strong></li>
</ul>
<h2 id="contribute">Contribute</h2>
<p>If you find bugs, feel free to do a pull request or open an <a href="https://github.com/n1try/http2-serverpush-proxy/issues">issue</a>. If you want to implement some of the above Todos, that&#39;d be great of course ;-)</p>
<h2 id="license">License</h2>
<p>MIT @ <a href="https://ferdinand-muetsch.de">Ferdinand MÃ¼tsch</a></p>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 02 May 2020</div><div class="column">Version: 1.0.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>