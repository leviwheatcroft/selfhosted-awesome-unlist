<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="*  Full stack, cross distro packaging software ."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body class="project"><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>omnibus</h1><span class="subheading">*  Full stack, cross distro packaging software .</span><div class="links"><a class="button button-outline" href="https://github.com/chef/omnibus"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>omnibus-ruby</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info statistics"><span class="stat pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>30 Apr 2020</span><span class="stat stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>1087</span><span class="stat issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>51</span></div></div></div><div class="row"><div class="column"><div class="info tags"><a class="tag" href="/selfhosted-awesome-unlist/languages/ruby.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>Ruby</a><a class="tag" href="/selfhosted-awesome-unlist/tags/packaging.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">5</span>packaging</a><a class="tag" href="/selfhosted-awesome-unlist/tags/sysadmin.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">371</span>sysadmin</a></div></div></div></div></section><article><div class="container"><div class="row"><div class="column"><h1 id="omnibus-icon-omnibus"><img src="lib/omnibus/assets/README-logo.png" alt="Omnibus Icon"> Omnibus</h1>
<p><a href="https://rubygems.org/gems/omnibus"><img src="http://img.shields.io/gem/v/omnibus.svg" alt="Gem Version"></a>
<a href="https://buildkite.com/chef-oss/chef-omnibus-master-verify"><img src="https://badge.buildkite.com/446fd6049a9a5eeab50112aba117d3b7670ec085acb91f78dd.svg?branch=master" alt="Build Status"></a>
<a href="https://ci.appveyor.com/project/chef/omnibus"><img src="http://img.shields.io/appveyor/ci/chef/omnibus.svg?label=AppVeyor" alt="AppVeyor Build Status"></a></p>
<p><strong>Umbrella Project</strong>: <a href="https://github.com/chef/chef-oss-practices/blob/master/projects/chef-foundation.md">Chef Foundation</a></p>
<p><strong>Project State</strong>: <a href="https://github.com/chef/chef-oss-practices/blob/master/repo-management/repo-states.md#active">Active</a></p>
<p><strong>Issues <a href="https://github.com/chef/chef-oss-practices/blob/master/repo-management/repo-states.md">Response Time Maximum</a></strong>: 14 days</p>
<p><strong>Pull Request <a href="https://github.com/chef/chef-oss-practices/blob/master/repo-management/repo-states.md">Response Time Maximum</a></strong>: 14 days</p>
<p>Easily create full-stack installers for your project across a variety of platforms.</p>
<p>Seth Chisamore and Christopher Maier of CHEF gave an introductory talk on Omnibus at ChefConf 2013, entitled <strong>Eat the Whole Bowl: Building a Full-Stack Installer with Omnibus</strong>:</p>
<ul>
<li><a href="http://www.youtube.com/watch?v=q8iJAntXCNY">Video</a></li>
<li><a href="https://speakerdeck.com/schisamo/eat-the-whole-bowl-building-a-full-stack-installer-with-omnibus">Slides</a></li>
</ul>
<p>This project is managed by the CHEF Release Engineering team. For more information on the Release Engineering team&#39;s contribution, triage, and release process, please consult the <a href="https://docs.google.com/a/opscode.com/document/d/1oJB0vZb_3bl7_ZU2YMDBkMFdL-EWplW1BJv_FXTUOzg/edit">CHEF Release Engineering OSS Management Guide</a>.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Omnibus is designed to run with a minimal set of prerequisites. You will need the following:</p>
<ul>
<li>Ruby 2.4+</li>
<li>Bundler</li>
</ul>
<h2 id="get-started">Get Started</h2>
<p>Omnibus provides both a DSL for defining Omnibus projects for your software, as well as a command-line tool for generating installer artifacts from that definition.</p>
<p>To get started, install Omnibus locally on your workstation.</p>
<pre><code class="language-bash">$ gem install omnibus</code></pre>
<p>You can now create an Omnibus project in your current directory by using the project generator feature.</p>
<pre><code class="language-bash">$ omnibus new $MY_PROJECT_NAME</code></pre>
<p>This will generate a complete project skeleton in the directory <code>omnibus-$MY_PROJECT_NAME</code></p>
<pre><code class="language-bash">$ cd omnibus-$MY_PROJECT_NAME
$ bundle install --binstubs
$ bin/omnibus build $MY_PROJECT_NAME</code></pre>
<p>More details can be found in the generated project&#39;s README file.</p>
<p>Omnibus determines the platform for which to build an installer based on <strong>the platform it is currently running on</strong>. That is, you can only generate a <code>.deb</code> file on a Debian-based system. To alleviate this caveat, the generated project includes a <a href="http://kitchen.ci">Test Kitchen</a> setup suitable for generating a series of Omnibus projects.</p>
<h2 id="more-documentation">More documentation</h2>
<ul>
<li><a href="docs/Building%20on%20Debian.md">Building on Debian</a></li>
<li><a href="docs/Building%20on%20OSX.md">Building on OSX</a></li>
<li><a href="docs/Building%20on%20RHEL.md">Building on RHEL</a></li>
<li><a href="docs/Building%20on%20Windows.md">Building on Windows</a></li>
<li><a href="docs/Build%20Cache.md">Build Cache</a></li>
</ul>
<h2 id="configuration-dsl">Configuration DSL</h2>
<p>Though the template project will build, it will not do anything exciting. For that, you need to use the Omnibus DSL to define the specifics of your application.</p>
<h3 id="config">Config</h3>
<p>If present, Omnibus will use a top-level configuration file named <code>omnibus.rb</code> at the root of your repository. This file is loaded at runtime and includes a number of configuration tunables. Here is an example:</p>
<pre><code class="language-ruby"># Build locally (instead of /var)
# -------------------------------
base_dir &#39;./local&#39;

# Disable git caching
# ------------------------------
use_git_caching false

# Enable S3 asset caching
# ------------------------------
use_s3_caching true
s3_bucket      ENV[&#39;S3_BUCKET&#39;]

# There are three ways to authenticate to the S3 bucket

# 1. set `s3_access_key` and `s3_secret_key`
s3_access_key  ENV[&#39;S3_ACCESS_KEY&#39;]
s3_secret_key  ENV[&#39;S3_SECRET_KEY&#39;]

# 2. set `s3_profile` to use an AWS profile in the Shared Credentials files
#s3_profile    ENV[&#39;S3_PROFILE&#39;]

# 3. set `s3_iam_role_arn` to use an AWS IAM role
#s3_iam_role_arn    ENV[&#39;S3_IAM_ROLE_ARN&#39;]</code></pre>
<p>For more information, please see the <a href="http://www.rubydoc.info/github/chef/omnibus/Omnibus/Config"><code>Config</code> documentation</a>.</p>
<p>You can tell Omnibus to load a different configuration file by passing the <code>--config</code> option to any command:</p>
<pre><code class="language-shell">$ bin/omnibus --config /path/to/config.rb</code></pre>
<p>Finally, you can override a specific configuration option at the command line using the <code>--override</code> flag. This takes ultimate precedence over any configuration file values:</p>
<pre><code class="language-shell">$ bin/omnibus --override use_git_caching:false</code></pre>
<h3 id="projects">Projects</h3>
<p>A Project DSL file defines your actual application; this is the thing you are creating a full-stack installer for in the first place. It provides a means to define the dependencies of the project (again, as specified in Software DSL definition files), as well as ways to set installer package metadata.</p>
<p>All project definitions must be in the <code>config/projects</code> directory of your Omnibus repository.</p>
<pre><code class="language-ruby">name            &quot;chef-full&quot;
maintainer      &quot;YOUR NAME&quot;
homepage        &quot;http://yoursite.com&quot;

install_dir     &quot;/opt/chef&quot;
build_version   &quot;0.10.8&quot;
build_iteration 4

dependency &quot;chef&quot;</code></pre>
<p>Some DSL methods available include:</p>
<table>
<thead>
<tr>
<th align="left">DSL Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>name</code></td>
<td>The name of the project</td>
</tr>
<tr>
<td align="left"><code>install_dir</code></td>
<td>The desired install location of the package</td>
</tr>
<tr>
<td align="left"><code>build_version</code></td>
<td>The package version</td>
</tr>
<tr>
<td align="left"><code>build_iteration</code></td>
<td>The package iteration number</td>
</tr>
<tr>
<td align="left"><code>dependency</code></td>
<td>An Omnibus software-defined component to include in this package</td>
</tr>
<tr>
<td align="left"><code>package</code></td>
<td>Invoke a packager-specific DSL</td>
</tr>
<tr>
<td align="left"><code>compress</code></td>
<td>Invoke a compressor-specific DSL</td>
</tr>
</tbody></table>
<p>By default a timestamp is appended to the build_version. You can turn this behavior off by setting <code>append_timestamp</code> to <code>false</code> in your configuration file or using <code>--override append_timestamp:false</code> at the command line.</p>
<p>For more information, please see the <a href="http://www.rubydoc.info/github/chef/omnibus/Omnibus/Project"><code>Project</code> documentation</a>.</p>
<h3 id="software">Software</h3>
<p>Omnibus &quot;software&quot; files define individual software components that go into making your overall package. They are the building blocks of your application. The Software DSL provides a way to define where to retrieve the software sources, how to build them, and what dependencies they have. These dependencies are also defined in their own Software DSL files, thus forming the basis for a dependency-aware build ordering.</p>
<p>All Software definitions should go in the <code>config/software</code> directory of your Omnibus project repository.</p>
<p>Here is an example:</p>
<pre><code class="language-ruby">name &quot;ruby&quot;
default_version &quot;1.9.2-p290&quot;
source url: &quot;http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-#{version}.tar.gz&quot;,
       md5: &quot;604da71839a6ae02b5b5b5e1b792d5eb&quot;

dependency &quot;zlib&quot;
dependency &quot;ncurses&quot;
dependency &quot;openssl&quot;

relative_path &quot;ruby-#{version}&quot;

build do
  command &quot;./configure&quot;
  command &quot;make&quot;
  command &quot;make install&quot;
end</code></pre>
<p>Some of the DSL methods available include:</p>
<table>
<thead>
<tr>
<th align="left">DSL Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>name</code></td>
<td>The name of the software component (this should come first)</td>
</tr>
<tr>
<td align="left"><code>default_version</code></td>
<td>The version of the software component</td>
</tr>
<tr>
<td align="left"><code>source</code></td>
<td>Directions to the location of the source</td>
</tr>
<tr>
<td align="left"><code>dependency</code></td>
<td>An Omnibus software-defined component that this software depends on</td>
</tr>
<tr>
<td align="left"><code>relative_path</code></td>
<td>The relative path of the extracted tarball</td>
</tr>
<tr>
<td align="left"><code>build</code></td>
<td>The build instructions</td>
</tr>
</tbody></table>
<p>For more DSL methods, please consult the <a href="http://rubydoc.info/github/chef/omnibus/Omnibus/Software"><code>Software</code> documentation</a>.</p>
<p>Additionally, there are a number of DSL methods available inside the <code>build</code> block:</p>
<table>
<thead>
<tr>
<th align="left">DSL Method</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>command</code></td>
<td>Execute a single shell command</td>
</tr>
<tr>
<td align="left"><code>make</code></td>
<td>Run make (with or without args), using gmake when appropriate</td>
</tr>
<tr>
<td align="left"><code>patch</code></td>
<td>Apply a patch from disk</td>
</tr>
<tr>
<td align="left"><code>workers</code></td>
<td>The maximum number of builders</td>
</tr>
<tr>
<td align="left"><code>windows_safe_path</code></td>
<td>Format the path to be safe for shelling out on Windows</td>
</tr>
<tr>
<td align="left"><code>ruby</code></td>
<td>Execute the code as the embedded Ruby</td>
</tr>
<tr>
<td align="left"><code>gem</code></td>
<td>Execute the code as the embedded Rubygems</td>
</tr>
<tr>
<td align="left"><code>bundle</code></td>
<td>Execute the code as the embedded Bundler</td>
</tr>
<tr>
<td align="left"><code>rake</code></td>
<td>Execute the code as the embedded Rake gem</td>
</tr>
<tr>
<td align="left"><code>block</code></td>
<td>Execute Ruby block at build time</td>
</tr>
<tr>
<td align="left"><code>erb</code></td>
<td>Render the given ERB template</td>
</tr>
<tr>
<td align="left"><code>mkdir</code></td>
<td>Create the given directory</td>
</tr>
<tr>
<td align="left"><code>touch</code></td>
<td>Create the given empty file</td>
</tr>
<tr>
<td align="left"><code>delete</code></td>
<td>Remove the given file or directory</td>
</tr>
<tr>
<td align="left"><code>strip</code></td>
<td>Strip symbols from binaries on a given file or directory</td>
</tr>
<tr>
<td align="left"><code>copy</code></td>
<td>Copy a to b</td>
</tr>
<tr>
<td align="left"><code>move</code></td>
<td>Move a to b</td>
</tr>
<tr>
<td align="left"><code>link</code></td>
<td>Link a to b</td>
</tr>
<tr>
<td align="left"><code>sync</code></td>
<td>Copy all files from a to b, removing any union files</td>
</tr>
</tbody></table>
<p>For more DSL methods, please consult the <a href="http://rubydoc.info/github/chef/omnibus/Omnibus/Builder"><code>Builder</code> documentation</a>.</p>
<p>You can support building multiple versions of the same software in the same software definition file using the <code>version</code> method and giving a block:</p>
<pre><code class="language-ruby">name &quot;ruby&quot;
default_version &quot;1.9.2-p290&quot;

version &quot;1.9.2-p290&quot; do
  source url: &quot;http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-#{version}.tar.gz&quot;,
         md5: &quot;604da71839a6ae02b5b5b5e1b792d5eb&quot;
end

version &quot;2.1.1&quot; do
  source url: &quot;http://ftp.ruby-lang.org/pub/ruby/2.1/ruby-#{version}.tar.gz&quot;,
         md5: &quot;e57fdbb8ed56e70c43f39c79da1654b2&quot;
end</code></pre>
<p>Since the software definitions are simply ruby code, you can conditionally execute anything by wrapping it with pure Ruby that tests for the version number.</p>
<h4 id="sharing-software-definitions">Sharing software definitions</h4>
<p>The easiest way to share organization-wide software is via bundler and Rubygems. For an example software repository, look at Chef&#39;s <a href="https://github.com/chef/omnibus-software">omnibus-software</a>. For more information, please see the <a href="http://guides.rubygems.org/publishing/">Rubygems documentation</a>.</p>
<p>It is recommended you use bundler to pull down these gems (as bundler also permits pulling software directly from GitHub):</p>
<pre><code class="language-ruby">gem &#39;my-company-omnibus-software&#39;
gem &#39;omnibus-software&#39;, github: &#39;my-company/omnibus-software&#39;</code></pre>
<p>Then add the name of the software to the list of <code>software_gems</code> in your Omnibus config:</p>
<pre><code class="language-ruby">software_gems %w(my-company-omnibus-software omnibus-software)</code></pre>
<p>You may also specify local paths on disk (but be warned this may make sharing the project among teams difficult):</p>
<pre><code class="language-ruby">local_software_dirs %w(/path/to/software /other/path/to/software)</code></pre>
<p>For all of these paths, <strong>order matters</strong>, so it is possible to depend on local software version while still retaining a remote software repo. Given the above example, Omnibus will search for a software definition named <code>foo</code> in this order:</p>
<pre><code class="language-text">$PWD/config/software/foo.rb
/path/to/software/config/software/foo.rb
/other/path/to/software/config/software/foo.rb
/Users/sethvargo/.gems/.../my-company-omnibus-software/config/software/foo.rb
/Users/sethvargo/.gems/.../omnibus-software/config/software/foo.rb</code></pre>
<p>The first instance of <code>foo.rb</code> that is encountered will be used. Please note that <strong>local</strong> (vendored) softare definitions take precedence!</p>
<h2 id="version-manifest">Version Manifest</h2>
<p>Git-based software definitions may specify branches as their default_version. In this case, the exact git revision to use will be determined at build-time unless a project override (see below) or external version manifest is used. To generate a version manifest use the <code>omnibus manifest</code> command:</p>
<pre><code>omnibus manifest PROJECT -l warn</code></pre><p>This will output a JSON-formatted manifest containing the resolved version of every software definition.</p>
<h2 id="whitelisting-libraries">Whitelisting Libraries</h2>
<p>Sometimes a platform has libraries that need to be whitelisted so the healthcheck can pass. The whitelist found in the <a href="https://github.com/chef/omnibus/blob/master/lib/omnibus/health_check.rb">healthcheck</a> code comprises the minimal required for successful builds on supported platforms.</p>
<p>To add your own whitelisted library, simply add a regex to your software definition in your omnibus project as follows:</p>
<pre><code>whitelist_file /libpcrecpp\.so\..+/</code></pre><p>It is typically a good idea to add a conditional to whitelist based on the specific platform that requires it.</p>
<p><em>Warning: You should only add libraries to the whitelist that are guaranteed to be on the system you install to; if a library comes from a non-default package you should instead build it into the package.</em></p>
<h2 id="changelog">Changelog</h2>
<p>STATUS: <em>EXPERIMENTAL</em></p>
<p><code>omnibus changelog generate</code> will generate a changelog for an omnibus project. This command currently assumes:</p>
<ul>
<li>A version-manifest.json file is checked into the project root</li>
<li>The project is a git repository</li>
<li>Each version is tagged with a SemVer compliant annotated tag</li>
<li>Any git-based sources are checked out at ../COMPONENT_NAME</li>
<li>Any commit message line prepended with ChangeLog-Entry: should be added to the changelog</li>
</ul>
<p>These assumptions <em>will</em> change as we determine what works best for a number of our projects.</p>
<h2 id="caveats">Caveats</h2>
<h3 id="overrides">Overrides</h3>
<p>The project definitions can override specific software dependencies by passing in <code>override</code> to use the correct version:</p>
<pre><code class="language-ruby">name &quot;chef-full&quot;
# &lt;snip&gt;

# This will override the default version of &quot;chef&quot;
override :chef, version: &quot;2.1.1&quot;

dependency &quot;chef&quot;</code></pre>
<p><strong>The overridden version must be defined in the associated software!</strong></p>
<h3 id="debugging">Debugging</h3>
<p>By default, Omnibus will log at the <code>warn</code> level. You can override this by passing the <code>--log-level</code> flag to your Omnibus call:</p>
<pre><code class="language-shell">$ bin/omnibus build &lt;project&gt; --log-level info # or &quot;debug&quot;</code></pre>
<h3 id="git-caching">Git caching</h3>
<p>by default, Omnibus caches compiled software definitions, so n+1 Omnibus project builds are much faster. This functionality can be disabled by adding the following to your <code>omnibus.rb</code>:</p>
<pre><code class="language-ruby">use_git_caching false</code></pre>
<h2 id="contributing">Contributing</h2>
<p>For information on contributing to this project see <a href="https://github.com/chef/chef/blob/master/CONTRIBUTING.md">https://github.com/chef/chef/blob/master/CONTRIBUTING.md</a></p>
<h2 id="license">License</h2>
<pre><code class="language-text">Copyright 2012-2016 Chef Software, Inc.

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</code></pre>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 03 May 2020</div><div class="column">Version: 1.1.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>