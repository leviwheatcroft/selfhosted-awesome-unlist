<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="*  Full stack, cross distro packaging software ."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body class="project"><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>omnibus</h1><span class="subheading">*  Full stack, cross distro packaging software .</span><div class="links"><a class="button button-outline" href="https://github.com/chef/omnibus"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>omnibus-ruby</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info statistics"><span class="stat pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>12 May 2020</span><span class="stat stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>1089</span><span class="stat issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>51</span></div></div></div><div class="row"><div class="column"><div class="info tags"><a class="tag" href="/selfhosted-awesome-unlist/tags/ruby.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">53</span>ruby</a><a class="tag" href="/selfhosted-awesome-unlist/tags/packaging.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">5</span>packaging</a><a class="tag" href="/selfhosted-awesome-unlist/tags/sysadmin.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">371</span>sysadmin</a></div></div></div></div></section><article><div class="container"><div class="row"><div class="column">
<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1><a id="user-content--omnibus" class="anchor" aria-hidden="true" href="#-omnibus"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a target="_blank" rel="noopener noreferrer" href="lib/omnibus/assets/README-logo.png"><img src="lib/omnibus/assets/README-logo.png" alt="Omnibus Icon" style="max-width:100%;"></a> Omnibus</h1>
<p><a href="https://rubygems.org/gems/omnibus" rel="nofollow"><img src="https://camo.githubusercontent.com/81ef248bfcaf9c4ad27708d8060fbead37b1ccba/687474703a2f2f696d672e736869656c64732e696f2f67656d2f762f6f6d6e696275732e737667" alt="Gem Version" data-canonical-src="http://img.shields.io/gem/v/omnibus.svg" style="max-width:100%;"></a>
<a href="https://buildkite.com/chef-oss/chef-omnibus-master-verify" rel="nofollow"><img src="https://camo.githubusercontent.com/a65f9b0b0237e1fa0d710dc8beeabfa019e86d48/68747470733a2f2f62616467652e6275696c646b6974652e636f6d2f34343666643630343961396135656561623530313132616261313137643362373637306563303835616362393166373864642e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://badge.buildkite.com/446fd6049a9a5eeab50112aba117d3b7670ec085acb91f78dd.svg?branch=master" style="max-width:100%;"></a>
<a href="https://ci.appveyor.com/project/chef/omnibus" rel="nofollow"><img src="https://camo.githubusercontent.com/e73145b63571c66a5da6aa12eaa1c336cca7a98f/687474703a2f2f696d672e736869656c64732e696f2f6170707665796f722f63692f636865662f6f6d6e696275732e7376673f6c6162656c3d4170705665796f72" alt="AppVeyor Build Status" data-canonical-src="http://img.shields.io/appveyor/ci/chef/omnibus.svg?label=AppVeyor" style="max-width:100%;"></a></p>
<p><strong>Umbrella Project</strong>: <a href="https://github.com/chef/chef-oss-practices/blob/master/projects/chef-foundation.md">Chef Foundation</a></p>
<p><strong>Project State</strong>: <a href="https://github.com/chef/chef-oss-practices/blob/master/repo-management/repo-states.md#active">Active</a></p>
<p><strong>Issues <a href="https://github.com/chef/chef-oss-practices/blob/master/repo-management/repo-states.md">Response Time Maximum</a></strong>: 14 days</p>
<p><strong>Pull Request <a href="https://github.com/chef/chef-oss-practices/blob/master/repo-management/repo-states.md">Response Time Maximum</a></strong>: 14 days</p>
<p>Easily create full-stack installers for your project across a variety of platforms.</p>
<p>Seth Chisamore and Christopher Maier of CHEF gave an introductory talk on Omnibus at ChefConf 2013, entitled <strong>Eat the Whole Bowl: Building a Full-Stack Installer with Omnibus</strong>:</p>
<ul>
<li><a href="http://www.youtube.com/watch?v=q8iJAntXCNY" rel="nofollow">Video</a></li>
<li><a href="https://speakerdeck.com/schisamo/eat-the-whole-bowl-building-a-full-stack-installer-with-omnibus" rel="nofollow">Slides</a></li>
</ul>
<p>This project is managed by the CHEF Release Engineering team. For more information on the Release Engineering team's contribution, triage, and release process, please consult the <a href="https://docs.google.com/a/opscode.com/document/d/1oJB0vZb_3bl7_ZU2YMDBkMFdL-EWplW1BJv_FXTUOzg/edit" rel="nofollow">CHEF Release Engineering OSS Management Guide</a>.</p>
<h2><a id="user-content-prerequisites" class="anchor" aria-hidden="true" href="#prerequisites"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<p>Omnibus is designed to run with a minimal set of prerequisites. You will need the following:</p>
<ul>
<li>Ruby 2.4+</li>
<li>Bundler</li>
</ul>
<h2><a id="user-content-get-started" class="anchor" aria-hidden="true" href="#get-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get Started</h2>
<p>Omnibus provides both a DSL for defining Omnibus projects for your software, as well as a command-line tool for generating installer artifacts from that definition.</p>
<p>To get started, install Omnibus locally on your workstation.</p>
<div class="highlight highlight-source-shell"><pre>$ gem install omnibus</pre></div>
<p>You can now create an Omnibus project in your current directory by using the project generator feature.</p>
<div class="highlight highlight-source-shell"><pre>$ omnibus new <span class="pl-smi">$MY_PROJECT_NAME</span></pre></div>
<p>This will generate a complete project skeleton in the directory <code>omnibus-$MY_PROJECT_NAME</code></p>
<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">cd</span> omnibus-<span class="pl-smi">$MY_PROJECT_NAME</span>
$ bundle install --binstubs
$ bin/omnibus build <span class="pl-smi">$MY_PROJECT_NAME</span></pre></div>
<p>More details can be found in the generated project's README file.</p>
<p>Omnibus determines the platform for which to build an installer based on <strong>the platform it is currently running on</strong>. That is, you can only generate a <code>.deb</code> file on a Debian-based system. To alleviate this caveat, the generated project includes a <a href="http://kitchen.ci" rel="nofollow">Test Kitchen</a> setup suitable for generating a series of Omnibus projects.</p>
<h2><a id="user-content-more-documentation" class="anchor" aria-hidden="true" href="#more-documentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>More documentation</h2>
<ul>
<li><a href="docs/Building%20on%20Debian.md">Building on Debian</a></li>
<li><a href="docs/Building%20on%20OSX.md">Building on OSX</a></li>
<li><a href="docs/Building%20on%20RHEL.md">Building on RHEL</a></li>
<li><a href="docs/Building%20on%20Windows.md">Building on Windows</a></li>
<li><a href="docs/Build%20Cache.md">Build Cache</a></li>
</ul>
<h2><a id="user-content-configuration-dsl" class="anchor" aria-hidden="true" href="#configuration-dsl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration DSL</h2>
<p>Though the template project will build, it will not do anything exciting. For that, you need to use the Omnibus DSL to define the specifics of your application.</p>
<h3><a id="user-content-config" class="anchor" aria-hidden="true" href="#config"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Config</h3>
<p>If present, Omnibus will use a top-level configuration file named <code>omnibus.rb</code> at the root of your repository. This file is loaded at runtime and includes a number of configuration tunables. Here is an example:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-c"># Build locally (instead of /var)</span>
<span class="pl-c"># -------------------------------</span>
<span class="pl-en">base_dir</span> <span class="pl-s">'./local'</span>

<span class="pl-c"># Disable git caching</span>
<span class="pl-c"># ------------------------------</span>
<span class="pl-en">use_git_caching</span> <span class="pl-c1">false</span>

<span class="pl-c"># Enable S3 asset caching</span>
<span class="pl-c"># ------------------------------</span>
<span class="pl-en">use_s3_caching</span> <span class="pl-c1">true</span>
<span class="pl-en">s3_bucket</span>      <span class="pl-c1">ENV</span><span class="pl-kos">[</span><span class="pl-s">'S3_BUCKET'</span><span class="pl-kos">]</span>

<span class="pl-c"># There are three ways to authenticate to the S3 bucket</span>

<span class="pl-c"># 1. set `s3_access_key` and `s3_secret_key`</span>
<span class="pl-en">s3_access_key</span>  <span class="pl-c1">ENV</span><span class="pl-kos">[</span><span class="pl-s">'S3_ACCESS_KEY'</span><span class="pl-kos">]</span>
<span class="pl-en">s3_secret_key</span>  <span class="pl-c1">ENV</span><span class="pl-kos">[</span><span class="pl-s">'S3_SECRET_KEY'</span><span class="pl-kos">]</span>

<span class="pl-c"># 2. set `s3_profile` to use an AWS profile in the Shared Credentials files</span>
<span class="pl-c">#s3_profile    ENV['S3_PROFILE']</span>

<span class="pl-c"># 3. set `s3_iam_role_arn` to use an AWS IAM role</span>
<span class="pl-c">#s3_iam_role_arn    ENV['S3_IAM_ROLE_ARN']</span></pre></div>
<p>For more information, please see the <a href="http://www.rubydoc.info/github/chef/omnibus/Omnibus/Config" rel="nofollow"><code>Config</code> documentation</a>.</p>
<p>You can tell Omnibus to load a different configuration file by passing the <code>--config</code> option to any command:</p>
<div class="highlight highlight-source-shell"><pre>$ bin/omnibus --config /path/to/config.rb</pre></div>
<p>Finally, you can override a specific configuration option at the command line using the <code>--override</code> flag. This takes ultimate precedence over any configuration file values:</p>
<div class="highlight highlight-source-shell"><pre>$ bin/omnibus --override use_git_caching:false</pre></div>
<h3><a id="user-content-projects" class="anchor" aria-hidden="true" href="#projects"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Projects</h3>
<p>A Project DSL file defines your actual application; this is the thing you are creating a full-stack installer for in the first place. It provides a means to define the dependencies of the project (again, as specified in Software DSL definition files), as well as ways to set installer package metadata.</p>
<p>All project definitions must be in the <code>config/projects</code> directory of your Omnibus repository.</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">name</span>            <span class="pl-s">"chef-full"</span>
<span class="pl-en">maintainer</span>      <span class="pl-s">"YOUR NAME"</span>
<span class="pl-en">homepage</span>        <span class="pl-s">"http://yoursite.com"</span>

<span class="pl-en">install_dir</span>     <span class="pl-s">"/opt/chef"</span>
<span class="pl-en">build_version</span>   <span class="pl-s">"0.10.8"</span>
<span class="pl-en">build_iteration</span> <span class="pl-c1">4</span>

<span class="pl-en">dependency</span> <span class="pl-s">"chef"</span></pre></div>
<p>Some DSL methods available include:</p>
<table>
<thead>
<tr>
<th align="left">DSL Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>name</code></td>
<td>The name of the project</td>
</tr>
<tr>
<td align="left"><code>install_dir</code></td>
<td>The desired install location of the package</td>
</tr>
<tr>
<td align="left"><code>build_version</code></td>
<td>The package version</td>
</tr>
<tr>
<td align="left"><code>build_iteration</code></td>
<td>The package iteration number</td>
</tr>
<tr>
<td align="left"><code>dependency</code></td>
<td>An Omnibus software-defined component to include in this package</td>
</tr>
<tr>
<td align="left"><code>package</code></td>
<td>Invoke a packager-specific DSL</td>
</tr>
<tr>
<td align="left"><code>compress</code></td>
<td>Invoke a compressor-specific DSL</td>
</tr>
</tbody>
</table>
<p>By default a timestamp is appended to the build_version. You can turn this behavior off by setting <code>append_timestamp</code> to <code>false</code> in your configuration file or using <code>--override append_timestamp:false</code> at the command line.</p>
<p>For more information, please see the <a href="http://www.rubydoc.info/github/chef/omnibus/Omnibus/Project" rel="nofollow"><code>Project</code> documentation</a>.</p>
<h3><a id="user-content-software" class="anchor" aria-hidden="true" href="#software"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Software</h3>
<p>Omnibus "software" files define individual software components that go into making your overall package. They are the building blocks of your application. The Software DSL provides a way to define where to retrieve the software sources, how to build them, and what dependencies they have. These dependencies are also defined in their own Software DSL files, thus forming the basis for a dependency-aware build ordering.</p>
<p>All Software definitions should go in the <code>config/software</code> directory of your Omnibus project repository.</p>
<p>Here is an example:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">name</span> <span class="pl-s">"ruby"</span>
<span class="pl-en">default_version</span> <span class="pl-s">"1.9.2-p290"</span>
<span class="pl-en">source</span> <span class="pl-pds">url</span>: <span class="pl-s">"http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-<span class="pl-s1"><span class="pl-kos">#{</span><span class="pl-en">version</span><span class="pl-kos">}</span></span>.tar.gz"</span><span class="pl-kos">,</span>
       <span class="pl-pds">md5</span>: <span class="pl-s">"604da71839a6ae02b5b5b5e1b792d5eb"</span>

<span class="pl-en">dependency</span> <span class="pl-s">"zlib"</span>
<span class="pl-en">dependency</span> <span class="pl-s">"ncurses"</span>
<span class="pl-en">dependency</span> <span class="pl-s">"openssl"</span>

<span class="pl-en">relative_path</span> <span class="pl-s">"ruby-<span class="pl-s1"><span class="pl-kos">#{</span><span class="pl-en">version</span><span class="pl-kos">}</span></span>"</span>

<span class="pl-en">build</span> <span class="pl-k">do</span>
  <span class="pl-en">command</span> <span class="pl-s">"./configure"</span>
  <span class="pl-en">command</span> <span class="pl-s">"make"</span>
  <span class="pl-en">command</span> <span class="pl-s">"make install"</span>
<span class="pl-k">end</span></pre></div>
<p>Some of the DSL methods available include:</p>
<table>
<thead>
<tr>
<th align="left">DSL Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>name</code></td>
<td>The name of the software component (this should come first)</td>
</tr>
<tr>
<td align="left"><code>default_version</code></td>
<td>The version of the software component</td>
</tr>
<tr>
<td align="left"><code>source</code></td>
<td>Directions to the location of the source</td>
</tr>
<tr>
<td align="left"><code>dependency</code></td>
<td>An Omnibus software-defined component that this software depends on</td>
</tr>
<tr>
<td align="left"><code>relative_path</code></td>
<td>The relative path of the extracted tarball</td>
</tr>
<tr>
<td align="left"><code>build</code></td>
<td>The build instructions</td>
</tr>
</tbody>
</table>
<p>For more DSL methods, please consult the <a href="http://rubydoc.info/github/chef/omnibus/Omnibus/Software" rel="nofollow"><code>Software</code> documentation</a>.</p>
<p>Additionally, there are a number of DSL methods available inside the <code>build</code> block:</p>
<table>
<thead>
<tr>
<th align="left">DSL Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>command</code></td>
<td>Execute a single shell command</td>
</tr>
<tr>
<td align="left"><code>make</code></td>
<td>Run make (with or without args), using gmake when appropriate</td>
</tr>
<tr>
<td align="left"><code>patch</code></td>
<td>Apply a patch from disk</td>
</tr>
<tr>
<td align="left"><code>workers</code></td>
<td>The maximum number of builders</td>
</tr>
<tr>
<td align="left"><code>windows_safe_path</code></td>
<td>Format the path to be safe for shelling out on Windows</td>
</tr>
<tr>
<td align="left"><code>ruby</code></td>
<td>Execute the code as the embedded Ruby</td>
</tr>
<tr>
<td align="left"><code>gem</code></td>
<td>Execute the code as the embedded Rubygems</td>
</tr>
<tr>
<td align="left"><code>bundle</code></td>
<td>Execute the code as the embedded Bundler</td>
</tr>
<tr>
<td align="left"><code>rake</code></td>
<td>Execute the code as the embedded Rake gem</td>
</tr>
<tr>
<td align="left"><code>block</code></td>
<td>Execute Ruby block at build time</td>
</tr>
<tr>
<td align="left"><code>erb</code></td>
<td>Render the given ERB template</td>
</tr>
<tr>
<td align="left"><code>mkdir</code></td>
<td>Create the given directory</td>
</tr>
<tr>
<td align="left"><code>touch</code></td>
<td>Create the given empty file</td>
</tr>
<tr>
<td align="left"><code>delete</code></td>
<td>Remove the given file or directory</td>
</tr>
<tr>
<td align="left"><code>strip</code></td>
<td>Strip symbols from binaries on a given file or directory</td>
</tr>
<tr>
<td align="left"><code>copy</code></td>
<td>Copy a to b</td>
</tr>
<tr>
<td align="left"><code>move</code></td>
<td>Move a to b</td>
</tr>
<tr>
<td align="left"><code>link</code></td>
<td>Link a to b</td>
</tr>
<tr>
<td align="left"><code>sync</code></td>
<td>Copy all files from a to b, removing any union files</td>
</tr>
</tbody>
</table>
<p>For more DSL methods, please consult the <a href="http://rubydoc.info/github/chef/omnibus/Omnibus/Builder" rel="nofollow"><code>Builder</code> documentation</a>.</p>
<p>You can support building multiple versions of the same software in the same software definition file using the <code>version</code> method and giving a block:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">name</span> <span class="pl-s">"ruby"</span>
<span class="pl-en">default_version</span> <span class="pl-s">"1.9.2-p290"</span>

<span class="pl-en">version</span> <span class="pl-s">"1.9.2-p290"</span> <span class="pl-k">do</span>
  <span class="pl-en">source</span> <span class="pl-pds">url</span>: <span class="pl-s">"http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-<span class="pl-s1"><span class="pl-kos">#{</span><span class="pl-en">version</span><span class="pl-kos">}</span></span>.tar.gz"</span><span class="pl-kos">,</span>
         <span class="pl-pds">md5</span>: <span class="pl-s">"604da71839a6ae02b5b5b5e1b792d5eb"</span>
<span class="pl-k">end</span>

<span class="pl-en">version</span> <span class="pl-s">"2.1.1"</span> <span class="pl-k">do</span>
  <span class="pl-en">source</span> <span class="pl-pds">url</span>: <span class="pl-s">"http://ftp.ruby-lang.org/pub/ruby/2.1/ruby-<span class="pl-s1"><span class="pl-kos">#{</span><span class="pl-en">version</span><span class="pl-kos">}</span></span>.tar.gz"</span><span class="pl-kos">,</span>
         <span class="pl-pds">md5</span>: <span class="pl-s">"e57fdbb8ed56e70c43f39c79da1654b2"</span>
<span class="pl-k">end</span></pre></div>
<p>Since the software definitions are simply ruby code, you can conditionally execute anything by wrapping it with pure Ruby that tests for the version number.</p>
<h4><a id="user-content-sharing-software-definitions" class="anchor" aria-hidden="true" href="#sharing-software-definitions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sharing software definitions</h4>
<p>The easiest way to share organization-wide software is via bundler and Rubygems. For an example software repository, look at Chef's <a href="https://github.com/chef/omnibus-software">omnibus-software</a>. For more information, please see the <a href="http://guides.rubygems.org/publishing/" rel="nofollow">Rubygems documentation</a>.</p>
<p>It is recommended you use bundler to pull down these gems (as bundler also permits pulling software directly from GitHub):</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">gem</span> <span class="pl-s">'my-company-omnibus-software'</span>
<span class="pl-en">gem</span> <span class="pl-s">'omnibus-software'</span><span class="pl-kos">,</span> <span class="pl-pds">github</span>: <span class="pl-s">'my-company/omnibus-software'</span></pre></div>
<p>Then add the name of the software to the list of <code>software_gems</code> in your Omnibus config:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">software_gems</span> <span class="pl-kos">%w(</span><span class="pl-s">my-company-omnibus-software</span> <span class="pl-s">omnibus-software</span><span class="pl-kos">)</span></pre></div>
<p>You may also specify local paths on disk (but be warned this may make sharing the project among teams difficult):</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">local_software_dirs</span> <span class="pl-kos">%w(</span><span class="pl-s">/path/to/software</span> <span class="pl-s">/other/path/to/software</span><span class="pl-kos">)</span></pre></div>
<p>For all of these paths, <strong>order matters</strong>, so it is possible to depend on local software version while still retaining a remote software repo. Given the above example, Omnibus will search for a software definition named <code>foo</code> in this order:</p>
<pre lang="text"><code>$PWD/config/software/foo.rb
/path/to/software/config/software/foo.rb
/other/path/to/software/config/software/foo.rb
/Users/sethvargo/.gems/.../my-company-omnibus-software/config/software/foo.rb
/Users/sethvargo/.gems/.../omnibus-software/config/software/foo.rb
</code></pre>
<p>The first instance of <code>foo.rb</code> that is encountered will be used. Please note that <strong>local</strong> (vendored) softare definitions take precedence!</p>
<h2><a id="user-content-version-manifest" class="anchor" aria-hidden="true" href="#version-manifest"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Version Manifest</h2>
<p>Git-based software definitions may specify branches as their default_version. In this case, the exact git revision to use will be determined at build-time unless a project override (see below) or external version manifest is used. To generate a version manifest use the <code>omnibus manifest</code> command:</p>
<pre><code>omnibus manifest PROJECT -l warn
</code></pre>
<p>This will output a JSON-formatted manifest containing the resolved version of every software definition.</p>
<h2><a id="user-content-whitelisting-libraries" class="anchor" aria-hidden="true" href="#whitelisting-libraries"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Whitelisting Libraries</h2>
<p>Sometimes a platform has libraries that need to be whitelisted so the healthcheck can pass. The whitelist found in the <a href="https://github.com/chef/omnibus/blob/master/lib/omnibus/health_check.rb">healthcheck</a> code comprises the minimal required for successful builds on supported platforms.</p>
<p>To add your own whitelisted library, simply add a regex to your software definition in your omnibus project as follows:</p>
<pre><code>whitelist_file /libpcrecpp\.so\..+/
</code></pre>
<p>It is typically a good idea to add a conditional to whitelist based on the specific platform that requires it.</p>
<p><em>Warning: You should only add libraries to the whitelist that are guaranteed to be on the system you install to; if a library comes from a non-default package you should instead build it into the package.</em></p>
<h2><a id="user-content-changelog" class="anchor" aria-hidden="true" href="#changelog"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Changelog</h2>
<p>STATUS: <em>EXPERIMENTAL</em></p>
<p><code>omnibus changelog generate</code> will generate a changelog for an omnibus project. This command currently assumes:</p>
<ul>
<li>A version-manifest.json file is checked into the project root</li>
<li>The project is a git repository</li>
<li>Each version is tagged with a SemVer compliant annotated tag</li>
<li>Any git-based sources are checked out at ../COMPONENT_NAME</li>
<li>Any commit message line prepended with ChangeLog-Entry: should be added to the changelog</li>
</ul>
<p>These assumptions <em>will</em> change as we determine what works best for a number of our projects.</p>
<h2><a id="user-content-caveats" class="anchor" aria-hidden="true" href="#caveats"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Caveats</h2>
<h3><a id="user-content-overrides" class="anchor" aria-hidden="true" href="#overrides"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overrides</h3>
<p>The project definitions can override specific software dependencies by passing in <code>override</code> to use the correct version:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">name</span> <span class="pl-s">"chef-full"</span>
<span class="pl-c"># &lt;snip&gt;</span>

<span class="pl-c"># This will override the default version of "chef"</span>
<span class="pl-en">override</span> <span class="pl-pds">:chef</span><span class="pl-kos">,</span> <span class="pl-pds">version</span>: <span class="pl-s">"2.1.1"</span>

<span class="pl-en">dependency</span> <span class="pl-s">"chef"</span></pre></div>
<p><strong>The overridden version must be defined in the associated software!</strong></p>
<h3><a id="user-content-debugging" class="anchor" aria-hidden="true" href="#debugging"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugging</h3>
<p>By default, Omnibus will log at the <code>warn</code> level. You can override this by passing the <code>--log-level</code> flag to your Omnibus call:</p>
<div class="highlight highlight-source-shell"><pre>$ bin/omnibus build <span class="pl-k">&lt;</span>project<span class="pl-k">&gt;</span> --log-level info <span class="pl-c"><span class="pl-c">#</span> or "debug"</span></pre></div>
<h3><a id="user-content-git-caching" class="anchor" aria-hidden="true" href="#git-caching"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Git caching</h3>
<p>by default, Omnibus caches compiled software definitions, so n+1 Omnibus project builds are much faster. This functionality can be disabled by adding the following to your <code>omnibus.rb</code>:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-en">use_git_caching</span> <span class="pl-c1">false</span></pre></div>
<h2><a id="user-content-contributing" class="anchor" aria-hidden="true" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contributing</h2>
<p>For information on contributing to this project see <a href="https://github.com/chef/chef/blob/master/CONTRIBUTING.md">https://github.com/chef/chef/blob/master/CONTRIBUTING.md</a></p>
<h2><a id="user-content-license" class="anchor" aria-hidden="true" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>License</h2>
<pre lang="text"><code>Copyright 2012-2016 Chef Software, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>
</article></div>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 24 May 2020</div><div class="column">Version: 1.3.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>