<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Plik is a scalable and friendly temporary file upload system."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/site.css" rel="stylesheet" type="text/css"></head></head><body><nav class="navigation"><section class="container"><a class="navigation-title" href="/">Selfhosted Awesome [Un]list</a><ul class="navigation-list float-right"><li class="navigation-item"><a class="navigation-link" href="https://github.com/leviwheatcroft/selfhosted-awesome-unlist"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>github</a></li></ul></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>plik</h1><span class="subheading"></span><div class="links"><a class="button button-outline" href="https://github.com/root-gg/plik"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>Plik</a><a class="button button-outline" href="https://plik.root.gg/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-box"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>Demo</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info"><div class="github"><span class="pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>12 Apr 2020</span><span class="stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>496</span><span class="issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>17</span></div><div class="tags"><a class="button" href="/tags/go.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Go</a><a class="button" href="/tags/file-sharing-and-synchronization.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>File Sharing and Synchronization</a><a class="button" href="/tags/selfhosted.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>selfhosted</a><a class="button" href="/tags/docker.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Docker</a></div></div></div></div></div></section><article><div class="container"><div class="row"><div class="column"><p><a href="https://travis-ci.org/root-gg/plik"><img src="https://travis-ci.org/root-gg/plik.svg?branch=master" alt="Build Status"></a>
<a href="http://goreportcard.com/report/root-gg/plik"><img src="https://img.shields.io/badge/Go_report-A+-brightgreen.svg" alt="Go Report"></a>
<a href="https://hub.docker.com/r/rootgg/plik"><img src="https://img.shields.io/docker/pulls/rootgg/plik.svg" alt="Docker Pulls"></a>
<a href="https://godoc.org/github.com/root-gg/plik"><img src="https://godoc.org/github.com/root-gg/plik?status.svg" alt="GoDoc"></a>
<a href="http://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License"></a></p>
<h1 id="plik">Plik</h1>
<p>Plik is a scalable &amp; friendly temporary file upload system ( wetransfer like ) in golang.</p>
<h3 id="main-features">Main features</h3>
<ul>
<li>Powerful command line client</li>
<li>Easy to use web UI</li>
<li>Multiple data backend : File, OpenStack Swift, S3</li>
<li>Multiple metadata backend : Sqlite3, postgresql</li>
<li>OneShot : Files are destructed after the first download</li>
<li>Stream : Files are streamed from the uploader to the downloader (nothing stored server side)  </li>
<li>Removable : Give the ability to the uploader to remove files at any time</li>
<li>TTL : Custom expiration date</li>
<li>Password : Protect upload with login/pasgisword (Auth Basic)</li>
<li>Comments : Add custom message (in Markdown format)</li>
<li>User authentication : Local / Google / OVH</li>
<li>Upload restriction : Source IP / Token</li>
<li>Administrator dashboard</li>
<li><a href="https://getsharex.com/">ShareX</a> Uploader : Directly integrated into ShareX</li>
<li><a href="https://github.com/iss0/plikSharp">plikSharp</a> : A .NET API client for Plik</li>
</ul>
<h3 id="version">Version</h3>
<p>1.3-RC1</p>
<h3 id="installation">Installation</h3>
<h5 id="from-release">From release</h5>
<p>To run plik, it&#39;s very simple :</p>
<pre><code class="language-sh">$ wget https://github.com/root-gg/plik/releases/download/1.3-RC1/plik-1.3-RC1-linux-64bits.tar.gz
$ tar xzvf plik-1.3-RC1-linux-64bits.tar.gz
$ cd plik-1.3-RC1/server
$ ./plikd</code></pre>
<p>Et voilà ! You now have a fully functional instance of Plik running on <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>.  
You can edit server/plikd.cfg to adapt the configuration to your needs (ports, ssl, ttl, backend params,...)</p>
<h5 id="from-rootgg-debian-repository">From root.gg Debian repository</h5>
<p>Configure root.gg repository and install server and/or client</p>
<pre><code>wget -O - http://mir.root.gg/gg.key | apt-key add -
echo &quot;deb http://mir.root.gg/ $(lsb_release --codename --short) main&quot; &gt; /etc/apt/sources.list.d/root.gg.list
apt-get update
apt-get install plikd plik</code></pre><p>Edit server configuration at /etc/plikd.cfg and start the server </p>
<pre><code>service plikd start</code></pre><h5 id="from-sources">From sources</h5>
<p>To compile plik from sources, you&#39;ll need golang and npm installed on your system.</p>
<p>First, get the project and libs via go get :</p>
<pre><code class="language-sh">$ go get github.com/root-gg/plik/server
go/src/github.com/root-gg/plik/server/handlers/misc.go:51: undefined: common.GetBuildInfo &lt;== ignore this warning
$ cd $GOPATH/src/github.com/root-gg/plik/</code></pre>
<p>Build everything and run it :</p>
<pre><code class="language-sh">$ make
$ cd server &amp;&amp; ./plikd</code></pre>
<h3 id="cli-client">Cli client</h3>
<p>Plik is shipped with a powerful golang multiplatform cli client (downloadable in web interface) :  </p>
<pre><code>Usage:
  plik [options] [FILE] ...

Options:
  -h --help                 Show this help
  -d --debug                Enable debug mode
  -q --quiet                Enable quiet mode
  -o, --oneshot             Enable OneShot ( Each file will be deleted on first download )
  -r, --removable           Enable Removable upload ( Each file can be deleted by anyone at anymoment )
  -S, --stream              Enable Streaming ( It will block until remote user starts downloading )
  -t, --ttl TTL             Time before expiration (Upload will be removed in m|h|d)
  -n, --name NAME           Set file name when piping from STDIN
  --server SERVER           Overrides plik url
  --token TOKEN             Specify an upload token
  --comments COMMENT        Set comments of the upload ( MarkDown compatible )
  -p                        Protect the upload with login and password
  --password PASSWD         Protect the upload with login:password ( if omitted default login is &quot;plik&quot; )
  -a                        Archive upload using default archive params ( see ~/.plikrc )
  --archive MODE            Archive upload using specified archive backend : tar|zip
  --compress MODE           [tar] Compression codec : gzip|bzip2|xz|lzip|lzma|lzop|compress|no
  --archive-options OPTIONS [tar|zip] Additional command line options
  -s                        Encrypt upload usnig default encrypt params ( see ~/.plikrc )
  --not-secure              Do not encrypt upload regardless of ~/.plikrc configurations
  --secure MODE             Archive upload using specified archive backend : openssl|pgp
  --cipher CIPHER           [openssl] Openssl cipher to use ( see openssl help )
  --passphrase PASSPHRASE   [openssl] Passphrase or &#39;-&#39; to be prompted for a passphrase
  --recipient RECIPIENT     [pgp] Set recipient for pgp backend ( example : --recipient Bob )
  --secure-options OPTIONS  [openssl|pgp] Additional command line options
  --update                  Update client
  -v --version              Show client version</code></pre><p>For example to create directory tar.gz archive and encrypt it with openssl :</p>
<pre><code class="language-bash">$ plik -a -s mydirectory/
Passphrase : 30ICoKdFeoKaKNdnFf36n0kMH
Upload successfully created : 
    https://127.0.0.1:8080/#/?id=0KfNj6eMb93ilCrl

mydirectory.tar.gz : 15.70 MB 5.92 MB/s

Commands :
curl -s &#39;https://127.0.0.1:8080/file/0KfNj6eMb93ilCrl/q73tEBEqM04b22GP/mydirectory.tar.gz&#39; | openssl aes-256-cbc -d -pass pass:30ICoKdFeoKaKNdnFf36n0kMH | tar xvf - --gzip</code></pre>
<p>Client configuration and preferences are stored at ~/.plikrc or /etc/plik/plikrc ( overridable with PLIKRC environement variable )</p>
<h3 id="quick-upload-using-curl-only">Quick upload using curl only</h3>
<pre><code class="language-bash">curl --form &#39;file=@/path/to/file&#39; http://127.0.0.1:8080</code></pre>
<p>DownloadDomain configuration option must be set for this to properly work.</p>
<h3 id="available-data-backends">Available data backends</h3>
<p>Plik is shipped with multiple data backend for uploaded files and metadata backend for the upload metadata.</p>
<ul>
<li>File databackend :</li>
</ul>
<p>Store uploaded files in a local or mounted file system directory.</p>
<ul>
<li>Openstack Swift databackend : <a href="http://docs.openstack.org/developer/swift/">http://docs.openstack.org/developer/swift/</a></li>
</ul>
<p>Openstack Swift is a highly available, distributed, eventually consistent object/blob store.</p>
<h3 id="available-metadata-backends">Available metadata backends</h3>
<ul>
<li>Sqlite3</li>
</ul>
<p>Suitable for standalone deployment.</p>
<ul>
<li>PostgreSQL</li>
</ul>
<p>Suitable for distributed / High Availability deployment.</p>
<h3 id="authentication">Authentication</h3>
<p>Plik can authenticate users using Local accounts or using Google or OVH APIs.</p>
<p>If source IP address restriction is enabled, user accounts can only be created from trusted IPs and then 
authenticated users can upload files without source IP restriction.</p>
<p>It possible to deny unauthenticated uploads totally ( NoAnonymousUploads ).  </p>
<p>Admin users can access the admin dashboard and manipulate every uploads.</p>
<ul>
<li><p><strong>Local</strong> :</p>
<ul>
<li><p>You can manipulate local users with the server command line</p>
<pre><code class="language-sh">$ ./plikd --config ./plikd.cfg user create --login root --name Admin --admin    
Generated password for user root is 08ybEyh2KkiMho8dzpdQaJZm78HmvWGC</code></pre>
</li>
</ul>
</li>
<li><p><strong>Google</strong> :</p>
<ul>
<li>You&#39;ll need to create a new application in the <a href="https://console.developers.google.com">Google Developper Console</a></li>
<li>You&#39;ll be handed a Google API ClientID and a Google API ClientSecret that you&#39;ll need to put in the plikd.cfg file.</li>
<li>Do not forget to whitelist valid origin and redirect url ( <a href="https://yourdomain/auth/google/callback">https://yourdomain/auth/google/callback</a> ) for your domain.</li>
<li>It is possible to whitelist only one or more email domains.</li>
</ul>
</li>
<li><p><strong>OVH</strong> :</p>
<ul>
<li>You&#39;ll need to create a new application in the OVH API : <a href="https://eu.api.ovh.com/createApp/">https://eu.api.ovh.com/createApp/</a></li>
<li>You&#39;ll be handed an OVH application key and an OVH application secret key that you&#39;ll need to put in the plikd.cfg file.</li>
</ul>
</li>
</ul>
<p>Once authenticated a user can generate upload tokens that can be specified in the ~/.plikrc file to authenticate
the command line client.</p>
<pre><code>Token = &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;</code></pre><h3 id="security">Security</h3>
<p>Plik allow users to upload and serve any content as-is, but hosting untrusted HTML raises some well known security concerns.</p>
<p>Plik will try to avoid HTML rendering by overriding Content-Type to &quot;text-plain&quot; instead of &quot;text/html&quot;.</p>
<p>By default Plik sets a couple of security HTTP headers like <strong>X-Content-Type-Options, X-XSS-Protection, X-Frame-Options, Content-Security-Policy</strong> to disable sensible features of most recent browsers like resource loading, xhr requests, iframes,...
This will however break features like audio/video playback, pdf rendering so it&#39;s possible to disable this behavior by setting the EnhancedWebSecurity configuration parameter to false</p>
<p>Along with that it is also strongly advised to serve uploaded files on a separate (sub-)domain to fight against phishing links and to protect Plik&#39;s session cookie with the DownloadDomain configuration parameter.  </p>
<h3 id="api">API</h3>
<p>Plik server expose a HTTP API to manage uploads and get files :</p>
<p>See the <a href="documentation/api.md">Plik API reference</a></p>
<h3 id="admin-cli">Admin CLI</h3>
<p>Using the ./plikd server binary it&#39;s possible to :</p>
<ul>
<li>create/list/delete local accounts</li>
<li>create/list/delete user CLI tokens</li>
<li>create/list/delete files and uploads</li>
<li>import / export metadata</li>
</ul>
<p>See help for more details</p>
<h3 id="docker">Docker</h3>
<p>Plik comes with a simple Dockerfile that allows you to run it in a container :</p>
<p>See the <a href="documentation/docker.md">Plik Docker reference</a></p>
<p>Plik also comes with some useful scripts to test backend in standalone docker instances :</p>
<p>See the <a href="testing">Plik Docker backend testing</a></p>
<h3 id="go-client">Go client</h3>
<p>Plik now comes with a golang library above which the cli client is built</p>
<p>See the <a href="plik/README.md">Plik library reference</a></p>
<h3 id="faq">FAQ</h3>
<ul>
<li>Why is stream mode broken in multiple instance deployement ?</li>
</ul>
<p>Beacause stream mode isn&#39;t stateless. As the uploader request will block on one plik instance the downloader request <strong>MUST</strong> go to the same instance to succeed.
The load balancing strategy <strong>MUST</strong> be aware of this and route stream requests to the same instance by hashing the file id.</p>
<p>Here is an example of how to achieve this using nginx and a little piece of LUA.
Make sure your nginx server is built with LUA scripting support.
You might want to install the &quot;nginx-extras&quot; Debian package (&gt;1.7.2) with built-in LUA support.</p>
<pre><code>upstream plik {
    server 127.0.0.1:8080;
    server 127.0.0.1:8081;
}

upstream stream {
    server 127.0.0.1:8080;
    server 127.0.0.1:8081;
    hash $hash_key;
}

server {
    listen 9000;

    location / {
        set $upstream &quot;&quot;;
        set $hash_key &quot;&quot;;
        access_by_lua &#39;
            _,_,file_id = string.find(ngx.var.request_uri, &quot;^/stream/[a-zA-Z0-9]+/([a-zA-Z0-9]+)/.*$&quot;)
            if file_id == nil then
                ngx.var.upstream = &quot;plik&quot;
            else
                ngx.var.upstream = &quot;stream&quot;
                ngx.var.hash_key = file_id
            end
        &#39;;
        proxy_pass http://$upstream;
    }
}</code></pre><ul>
<li>Redirection loops with DownloadDomain enforcement and reverse proxy</li>
</ul>
<pre><code>Invalid download domain 127.0.0.1:8080, expected plik.root.gg</code></pre><p>DownloadDomain check the Host header of the incoming HTTP request, by default reverse proxies like
Nginx or Apache mod_proxy does not forward this Header. Check the following configuration directive :</p>
<pre><code>Apache mod_proxy : ProxyPreserveHost On
Nginx : proxy_set_header Host $host;</code></pre><ul>
<li>I have an error when uploading from client : &quot;Unable to upload file : HTTP error 411 Length Required&quot;</li>
</ul>
<p>Under nginx &lt; 1.3.9, you must enable HttpChunkin module to allow transfer-encoding &quot;chunked&quot;.<br>You might want to install the &quot;nginx-extras&quot; Debian package with built-in HttpChunkin module.</p>
<p>And add in your server configuration :</p>
<pre><code class="language-sh">chunkin on;
error_page 411 = @my_411_error;
location @my_411_error {
        chunkin_resume;
}</code></pre>
<ul>
<li>How to disable nginx buffering ?</li>
</ul>
<p>By default nginx buffers large HTTP requests and reponses to a temporary file. This behaviour leads to unnecessary disk load and slower transfers. This should be turned off (&gt;1.7.12) for /file and /stream paths. You might also want to increase buffers size.</p>
<p>Detailed documentation : <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering</a></p>
<pre><code>proxy_buffering off;
proxy_request_buffering off;
proxy_http_version 1.1;
proxy_buffer_size 1M;
proxy_buffers 8 1M;
client_body_buffer_size 1M;</code></pre><ul>
<li>Why authentication does not work with HTTP connections when EnhancedWebSecurity is set ?</li>
</ul>
<p>Plik session cookies have the &quot;secure&quot; flag set when EnhancedWebSecurity is set so they can only be transmitted over secure HTTPS connections.</p>
<ul>
<li>Build failure &quot;/usr/bin/env: ‘node’: No such file or directory&quot;</li>
</ul>
<p>Debian users might need to install the nodejs-legacy package.</p>
<pre><code>This package contains a symlink for legacy Node.js code requiring
binary to be /usr/bin/node (not /usr/bin/nodejs as provided in Debian).</code></pre><ul>
<li>How to take and upload screenshots like a boss ?</li>
</ul>
<pre><code>alias pshot=&quot;scrot -s -e &#39;plik -q \$f | xclip ; xclip -o ; rm \$f&#39;&quot;</code></pre><p>Requires you to have plik, scrot and xclip installed in your $PATH.<br>scrot -s allow you to &quot;Interactively select a window or rectangle with the mouse&quot; then
Plik will upload the screenshot and the url will be directly copied to your clipboard and displayed by xclip.
The screenshot is then removed of your home directory to avoid garbage.</p>
<ul>
<li>How to contribute to the project ?</li>
</ul>
<p>Contributions are welcome, feel free to open issues and/or submit pull requests.
Please be sure to also run/update the test suite :</p>
<pre><code>    make fmt
    make lint
    make test
    make test-backends</code></pre></div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 02 May 2020</div><div class="column">Version: 1.0.0</div></div></div></footer><script src="/site.js"></script></body></html>