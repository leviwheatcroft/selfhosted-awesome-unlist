<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Mozilla WebThings is Mozilla’s open source implementation of the Web of Things, including the WebThings Gateway and the WebThings framework."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body class="project"><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>gateway</h1><span class="subheading">Mozilla WebThings is Mozilla’s open source implementation of the Web of Things, including the WebThings Gateway and the WebThings framework.</span><div class="links"><a class="button button-outline" href="https://iot.mozilla.org/gateway/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>Mozilla Gateway</a><a class="button button-outline" href="https://github.com/mozilla-iot/gateway"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>Source Code</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info statistics"><span class="stat pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>30 Apr 2020</span><span class="stat stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>2201</span><span class="stat issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>173</span></div></div></div><div class="row"><div class="column"><div class="info tags"><a class="tag" href="/selfhosted-awesome-unlist/languages/javascript.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>JavaScript</a><a class="tag" href="/selfhosted-awesome-unlist/tags/internet-of-things-iot.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">9</span>internet of things (iot)</a><a class="tag" href="/selfhosted-awesome-unlist/tags/selfhosted.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">943</span>selfhosted</a><a class="tag" href="/selfhosted-awesome-unlist/tags/docker.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">327</span>docker</a></div></div></div></div></section><article><div class="container"><div class="row"><div class="column"><h1 id="webthings-gateway-by-mozilla">WebThings Gateway by Mozilla</h1>
<p><a href="https://github.com/mozilla-iot/gateway/actions?query=workflow%3ABuild"><img src="https://github.com/mozilla-iot/gateway/workflows/Build/badge.svg" alt="Build Status"></a>
<a href="https://codecov.io/gh/mozilla-iot/gateway"><img src="https://codecov.io/gh/mozilla-iot/gateway/branch/master/graph/badge.svg" alt="codecov"></a>
<a href="https://david-dm.org/mozilla-iot/gateway"><img src="https://david-dm.org/mozilla-iot/gateway.svg" alt="dependencies"></a>
<a href="https://david-dm.org/mozilla-iot/gateway?type=dev"><img src="https://david-dm.org/mozilla-iot/gateway/dev-status.svg" alt="devDependencies"></a>
<a href="LICENSE"><img src="https://img.shields.io/badge/license-MPL--2.0-blue.svg" alt="license"></a></p>
<p>Web of Things gateway.</p>
<h2 id="installation">Installation</h2>
<ul>
<li>If you have a Rasberry Pi, the easiest way to use the gateway is to <a href="http://iot.mozilla.org/gateway/">download and flash</a> a pre-built software image from Mozilla to an SD card.</li>
<li>If you prefer to use Docker, we have a prebuilt Docker image available <a href="https://hub.docker.com/r/mozillaiot/gateway">here</a>, for both ARM and amd64. You can also build your own image from <a href="https://github.com/mozilla-iot/gateway-docker">this repository</a>.</li>
<li>On Fedora, Debian, Raspbian, or Ubuntu, you can install the relevant .rpm or .deb package from the <a href="https://github.com/mozilla-iot/gateway/releases">releases page</a>. Those packages are built from the <a href="https://github.com/mozilla-iot/gateway-rpm">gateway-rpm</a> and <a href="https://github.com/mozilla-iot/gateway-deb">gateway-deb</a> repos.</li>
<li>On Arch Linux, you can install the <a href="https://aur.archlinux.org/packages/webthings-gateway/">webthings-gateway AUR package</a>. The PKGBUILD for this package can also be seen <a href="https://github.com/mozilla-iot/gateway-aur">here</a>.</li>
<li>Otherwise, you can build it from source yourself (see below).</li>
</ul>
<h2 id="documentation">Documentation</h2>
<ul>
<li><a href="https://iot.mozilla.org/docs/gateway-getting-started-guide.html">Getting Started Guide</a></li>
<li><a href="https://iot.mozilla.org/docs/gateway-user-guide.html">User Guide</a></li>
<li><a href="https://github.com/mozilla-iot/wiki/wiki">Wiki</a></li>
<li><a href="https://iot.mozilla.org/docs/">Various other docs</a></li>
</ul>
<h2 id="community">Community</h2>
<ul>
<li><a href="https://discourse.mozilla.org/c/iot">Discourse</a></li>
<li><a href="https://matrix.to/#/#iot:mozilla.org">Matrix</a> (<code>#iot:mozilla.org</code>)</li>
</ul>
<h2 id="prerequisites-for-building">Prerequisites for Building</h2>
<h3 id="install-os">Install OS</h3>
<p>(If you&#39;re just installing on your PC, you can skip this step).</p>
<p>If you&#39;re installing on a Raspberry Pi then you may need to set up the OS on the Raspberry Pi first. <a href="https://github.com/mozilla-iot/wiki/wiki/Setting-up-Raspberry-Pi">See here</a> for instructions.</p>
<h3 id="update-package-cache-linux-only">Update Package Cache (Linux only)</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt update</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf --refresh upgrade</code></pre><h3 id="install-pkg-config">Install pkg-config</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install pkg-config</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install pkgconfig</code></pre><p>Under macOS:</p>
<pre><code>$ brew install pkg-config</code></pre><h3 id="install-curl-needed-to-install-nvm">Install curl (needed to install nvm)</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install curl</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install curl</code></pre><h3 id="install-nvm-recommended">Install nvm (Recommended)</h3>
<p>nvm allows you to easily install different versions of node. To install nvm:</p>
<pre><code>$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash</code></pre><p>Reinitialize your terminal session.</p>
<pre><code>$ . ~/.bashrc</code></pre><h3 id="install-node-if-you-didnt-use-nvm">Install node (if you didn&#39;t use nvm)</h3>
<p>(If you already installed node via nvm you can skip this step)</p>
<p>Follow the directions from <a href="https://nodejs.org">NodeJS</a> to install on your platform.</p>
<h3 id="set-up-bluetooth-permissions-linux-only">Set up Bluetooth permissions (Linux only)</h3>
<p>The following is required in order to let node and python3 use the Bluetooth adapter.</p>
<pre><code>$ sudo setcap cap_net_raw+eip $(eval readlink -f `which node`)
$ sudo setcap cap_net_raw+eip $(eval readlink -f `which python3`)</code></pre><h3 id="install-bluetooth-and-bt-low-energy-support-libraries-linux-only">Install Bluetooth and BT Low Energy support libraries (Linux only)</h3>
<p>The following are required in order to install the Python modules that support Bluetooth</p>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install libboost-python-dev libboost-thread-dev libbluetooth-dev libglib2.0-dev</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install boost-python2-devel boost-python3-devel boost-devel bluez-libs-devel glib2-devel</code></pre><h3 id="install-libusb-and-libudev-linux-only">Install libusb and libudev (Linux only)</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install libusb-1.0-0-dev libudev-dev</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install libudev-devel libusb1-devel</code></pre><h3 id="install-autoconf">Install autoconf</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install autoconf</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install autoconf</code></pre><p>Under macOS:</p>
<pre><code>$ brew install autoconf</code></pre><h3 id="install-libpng-linux-only">Install libpng (Linux only)</h3>
<p>Under x86-64 or x86 Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install libpng16-16</code></pre><p>Under ARM Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install libpng-dev</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install libpng-devel</code></pre><h3 id="install-libffi">Install libffi</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install libffi-dev</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install libffi-devel</code></pre><p>Under macOS:</p>
<pre><code>$ brew install libffi</code></pre><h3 id="install-git">Install git</h3>
<p>You&#39;ll need git to checkout the repositories.</p>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install git</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install git</code></pre><h3 id="install-gcc">Install gcc</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install build-essential</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf group install &quot;C Development Tools and Libraries&quot;</code></pre><h3 id="install-python-tools">Install Python tools</h3>
<p>Under Ubuntu/Debian Linux:</p>
<pre><code>$ sudo apt install python-pip python3-pip
$ sudo python2 -m pip install six
$ sudo python3 -m pip install git+https://github.com/mozilla-iot/gateway-addon-python#egg=gateway_addon</code></pre><p>Under Fedora Linux:</p>
<pre><code>$ sudo dnf install python2-pip python3-pip
$ sudo python2 -m pip install six
$ sudo python3 -m pip install git+https://github.com/mozilla-iot/gateway-addon-python#egg=gateway_addon</code></pre><h2 id="download-and-build-gateway">Download and Build Gateway</h2>
<ul>
<li><p>Clone the GitHub repository (or fork it first):</p>
<pre><code>  $ git clone https://github.com/mozilla-iot/gateway.git</code></pre></li>
<li><p>Change into the gateway directory:</p>
<pre><code>  $ cd gateway</code></pre></li>
<li><p>If you have chosen to install nvm above, install and use an LTS version of node and then set the default version. The <strong><code>.nvmrc</code></strong> file will be used by nvm to determine which version of node to install.</p>
<pre><code>  $ nvm install
  $ nvm use
  $ nvm alias default $(node -v)</code></pre></li>
<li><p>Verify that node and npm have been installed:</p>
<pre><code>  $ node --version
  v10.19.0
  $ npm --version
  6.14.0</code></pre><p>  Note: these versions might differ from the LTS version installed locally.</p>
</li>
<li><p>Install dependencies:</p>
<pre><code>  $ npm ci</code></pre></li>
<li><p>Add Firewall exceptions (Fedora Linux Only)</p>
<pre><code>  $ sudo firewall-cmd --zone=public --add-port=4443/tcp --permanent
  $ sudo firewall-cmd --zone=public --add-port=8080/tcp --permanent
  $ sudo firewall-cmd --zone=public --add-port=5353/udp --permanent</code></pre></li>
</ul>
<ul>
<li><p>Set up domain:</p>
<ul>
<li><p>If you plan to use Mozilla&#39;s provided tunneling service to set up a <code>*.mozilla-iot.org</code> domain:</p>
<ul>
<li><p>Start the web server:</p>
<pre><code>  $ npm start</code></pre></li>
<li><p>Load <code>http://localhost:8080</code> in your web browser (or use the server&#39;s IP address if loading remotely). Then follow the instructions on the web page to set up domain and register. Once this is done you can load
<code>https://localhost:4443</code> in your web browser (or use the server&#39;s IP address if loading remotely).</p>
</li>
</ul>
</li>
<li><p>If you plan to use your own SSL certificate:</p>
<ul>
<li><p>The HTTPS server looks for <code>privatekey.pem</code> and <code>certificate.pem</code> in the <code>ssl</code> sub-directory of the <code>userProfile</code> directory specified in your config. You can use a real certificate or generate a self-signed one by following the steps below.</p>
<pre><code>  $ MOZIOT_HOME=&quot;${MOZIOT_HOME:=${HOME}/.mozilla-iot}&quot;
  $ SSL_DIR=&quot;${MOZIOT_HOME}/ssl&quot;
  $ [ ! -d &quot;${SSL_DIR}&quot; ] &amp;&amp; mkdir -p &quot;${SSL_DIR}&quot;
  $ openssl genrsa -out &quot;${SSL_DIR}/privatekey.pem&quot; 2048
  $ openssl req -new -sha256 -key &quot;${SSL_DIR}/privatekey.pem&quot; -out &quot;${SSL_DIR}/csr.pem&quot;
  $ openssl x509 -req -in &quot;${SSL_DIR}/csr.pem&quot; -signkey &quot;${SSL_DIR}/privatekey.pem&quot; -out &quot;${SSL_DIR}/certificate.pem&quot;</code></pre></li>
<li><p>Start the web server:</p>
<pre><code>  $ npm start</code></pre></li>
<li><p>Load <code>https://localhost:4443</code> in your web browser (or use the server&#39;s IP address if loading remotely). Since you&#39;re using a self-signed certificate, you&#39;ll need to add a security exception in the browser.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="browser-support">Browser Support</h2>
<p>The Gateway only supports the following browsers, due to its use of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch"><code>Fetch API</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API"><code>WebSocket API</code></a>:</p>
<ul>
<li>Firefox 52+</li>
<li>Chrome 43+</li>
<li>Edge 14+</li>
<li>Safari 10.1+</li>
<li>Opera 29+</li>
</ul>
<h2 id="debugging">Debugging</h2>
<p>If you are using VS Code, simply use the &quot;launch&quot; target. It will build the gateway in debugger mode.</p>
<p>If you are not using VS Code, run <code>npm run debug</code> and it will build the gateway and launch it with <code>--inspect</code>.</p>
<h2 id="install-additional-dependencies-for-test-debian">Install additional dependencies for Test (Debian)</h2>
<p>These steps are required on Debian</p>
<pre><code>$ sudo apt install firefox openjdk-8-jre</code></pre><h2 id="running-tests">Running Tests</h2>
<p>To run the linter and all tests:</p>
<pre><code>$ npm test</code></pre><p>To run a single test:</p>
<pre><code>$ jest src/test/{test-name}.js</code></pre><p>(assumes you have the <code>jest</code> command on your <code>PATH</code>, otherwise use <code>./node_modules/jest/bin/jest.js</code>)</p>
<p>To compare UI with parent branch:</p>
<pre><code>$ npm run screenshots
$ npm test</code></pre><p>(if you have the screenshots in the folder <code>./browser-test-screenshots</code>, <code>npm test</code> should compare UI with screenshots stored)</p>
<h2 id="source-code-structure">Source Code Structure</h2>
<ul>
<li><strong><code>config/</code></strong> - Gateway configuration files</li>
<li><strong><code>image/</code></strong> - Tools for building the Raspberry Pi image</li>
<li><strong><code>src/</code></strong><ul>
<li><strong><code>addons-test/</code></strong> - Add-ons used strictly for testing</li>
<li><strong><code>controllers/</code></strong> - App URL routes and their logic</li>
<li><strong><code>models/</code></strong> - Data model and business logic</li>
<li><strong><code>platforms/</code></strong> - Platform-specific functionality</li>
<li><strong><code>plugin/</code></strong> - Utility classes and methods used by add-ons</li>
<li><strong><code>rules-engine/</code></strong> - The rules engine</li>
<li><strong><code>test/</code></strong> - Integration tests</li>
<li><strong><code>views/</code></strong> - HTML views</li>
<li><strong><code>addon-loader.js</code></strong> - Script used for starting up Node-based add-ons</li>
<li><strong><code>addon-manager.js</code></strong> - Manages add-ons (e.g. Zigbee, Z-Wave)</li>
<li><strong><code>app.js</code></strong> - The main back end</li>
<li><strong><code>certificate-manager.js</code></strong> - Certificate registration and renewal, via Let&#39;s Encrypt</li>
<li><strong><code>command-utils.js</code></strong> - Utilities used by commands parser</li>
<li><strong><code>constants.js</code></strong> - System-wide constants</li>
<li><strong><code>db.js</code></strong> - Manages the SQLite3 database</li>
<li><strong><code>deferred.js</code></strong> - Wraps up a promise in a slightly more convenient manner for passing around, or saving</li>
<li><strong><code>dynamic-require.js</code></strong> - Small utility to require code from file system, rather than webpacked bundle</li>
<li><strong><code>ec-crypto.js</code></strong> - Elliptic curve helpers for the ES256 curve</li>
<li><strong><code>jwt-middleware.js</code></strong> - Express middleware for determining authentication status</li>
<li><strong><code>log-timestamps.js</code></strong> - Utilities for adding timestamps to console logging functions</li>
<li><strong><code>mdns-server.js</code></strong> - mDNS server</li>
<li><strong><code>oauth-types.js</code></strong> - OAuth types</li>
<li><strong><code>passwords.js</code></strong> - Password utilities</li>
<li><strong><code>platform.js</code></strong> - Platform-specific utilities</li>
<li><strong><code>push-service.js</code></strong> - Push notification service</li>
<li><strong><code>router.js</code></strong> - Routes app URLs to controllers</li>
<li><strong><code>router-setup.js</code></strong> - Initial router setup code for OpenWrt</li>
<li><strong><code>sleep.js</code></strong> - Small utility to implement a promise-based sleep</li>
<li><strong><code>ssltunnel.js</code></strong> - Utilities to determine state of tunnel and manage the PageKite process</li>
<li><strong><code>user-profile.js</code></strong> - Manages persistent user data</li>
<li><strong><code>utils.js</code></strong> - Various utility functions</li>
<li><strong><code>wifi-setup.js</code></strong> - Initial Wi-Fi setup code for Raspbian</li>
</ul>
</li>
<li><strong><code>static/</code></strong> - Static CSS, JavaScript &amp; image resources for web app front end</li>
<li><strong><code>tools/</code></strong> - Helpful utilities (not part of the build)</li>
<li><strong><code>package.json</code></strong> - npm module manifest</li>
</ul>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 03 May 2020</div><div class="column">Version: 1.1.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>