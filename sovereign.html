<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Set of Ansible playbooks to build and maintain your own private cloud: email, calendar, contacts, file sync, IRC bouncer, VPN, and more."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body class="project"><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>sovereign</h1><span class="subheading">Set of Ansible playbooks to build and maintain your own private cloud: email, calendar, contacts, file sync, IRC bouncer, VPN, and more.</span><div class="links"><a class="button button-outline" href="https://github.com/sovereign/sovereign"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>sovereign</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info statistics"><span class="stat pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>05 Apr 2020</span><span class="stat stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>9670</span><span class="stat issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>96</span></div></div></div><div class="row"><div class="column"><div class="info tags"><a class="tag" href="/selfhosted-awesome-unlist/languages/undefined.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></a><a class="tag" href="/selfhosted-awesome-unlist/languages/undefined.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></a><a class="tag" href="/selfhosted-awesome-unlist/languages/undefined.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></a><a class="tag" href="/selfhosted-awesome-unlist/languages/undefined.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></a><a class="tag" href="/selfhosted-awesome-unlist/languages/undefined.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></a><a class="tag" href="/selfhosted-awesome-unlist/languages/undefined.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-code"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></a><a class="tag" href="/selfhosted-awesome-unlist/tags/python.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">116</span>python</a><a class="tag" href="/selfhosted-awesome-unlist/tags/self-hosting-solutions.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">20</span>self-hosting solutions</a><a class="tag" href="/selfhosted-awesome-unlist/tags/selfhosted.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">943</span>selfhosted</a><a class="tag" href="/selfhosted-awesome-unlist/tags/docker.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">327</span>docker</a></div></div></div></div></section><article><div class="container"><div class="row"><div class="column"><p><a href="https://travis-ci.org/sovereign/sovereign"><img src="https://travis-ci.org/sovereign/sovereign.svg?branch=master" alt="Build Status"></a>
<a href="https://bestpractices.coreinfrastructure.org/projects/460"><img src="https://bestpractices.coreinfrastructure.org/projects/460/badge" alt="CII Best Practices"></a></p>
<h1 id="introduction">Introduction</h1>
<p>Sovereign is a set of <a href="http://ansible.com">Ansible</a> playbooks that you can use to build and maintain your own <a href="http://www.urbandictionary.com/define.php?term=clown%20computing">personal cloud</a> based entirely on open source software, so you’re in control.</p>
<p>If you’ve never used Ansible before, you might find these playbooks useful to learn from, since they show off a fair bit of what the tool can do.</p>
<p>The original author&#39;s <a href="https://github.com/sovereign/sovereign/wiki/Background-and-Motivations">background and motivations</a> might be of interest. tl;dr: frustrations with Google Apps and concerns about privacy and long-term support.</p>
<p>Sovereign offers useful cloud services while being reasonably secure and low-maintenance. Use it to set up your server, SSH in every couple weeks, but mostly forget about it.</p>
<h2 id="services-provided">Services Provided</h2>
<p>What do you get if you point Sovereign at a server? All kinds of good stuff!</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Internet_Message_Access_Protocol">IMAP</a> over SSL via <a href="http://dovecot.org/">Dovecot</a>, complete with full text search provided by <a href="https://lucene.apache.org/solr/">Solr</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/Post_Office_Protocol">POP3</a> over SSL, also via Dovecot</li>
<li><a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">SMTP</a> over SSL via Postfix, including a nice set of <a href="https://en.wikipedia.org/wiki/DNSBL">DNSBLs</a> to discard spam before it ever hits your filters.</li>
<li>Virtual domains for your email, backed by <a href="http://www.postgresql.org/">PostgreSQL</a>.</li>
<li>Spam fighting via <a href="https://www.rspamd.com/">Rspamd</a>.</li>
<li>Mail server verification using <a href="http://www.dkim.org/">DKIM</a> and <a href="http://www.dmarc.org/">DMARC</a> so the Internet knows your mailserver is legit.</li>
<li>Secure on-disk storage for email and more via <a href="http://www.arg0.net/encfs">EncFS</a>.</li>
<li>Webmail via <a href="http://www.roundcube.net/">Roundcube</a>.</li>
<li>Mobile push notifications via <a href="http://z-push.sourceforge.net/soswp/index.php?pages_id=1&amp;t=home">Z-Push</a>.</li>
<li>Email client <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Thunderbird/Autoconfiguration">automatic configuration</a>.</li>
<li>Jabber/<a href="http://xmpp.org/">XMPP</a> instant messaging via <a href="http://prosody.im/">Prosody</a>.</li>
<li>An RSS Reader via <a href="http://selfoss.aditu.de/">Selfoss</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/CalDAV">CalDAV</a> and <a href="https://en.wikipedia.org/wiki/CardDAV">CardDAV</a> to keep your calendars and contacts in sync, via <a href="http://owncloud.org/">ownCloud</a>.</li>
<li>Your own private storage cloud via <a href="http://owncloud.org/">ownCloud</a>.</li>
<li>Your own VPN server via <a href="http://openvpn.net/index.php/open-source.html">OpenVPN</a>.</li>
<li>An IRC bouncer via <a href="http://wiki.znc.in/ZNC">ZNC</a>.</li>
<li><a href="http://mmonit.com/monit/">Monit</a> to keep everything running smoothly (and alert you when it’s not).</li>
<li><a href="http://collectd.org/">collectd</a> to collect system statistics.</li>
<li>Web hosting (ex: for your blog) via <a href="https://www.apache.org/">Apache</a>.</li>
<li>Firewall management via <a href="https://wiki.ubuntu.com/UncomplicatedFirewall">Uncomplicated Firewall (ufw)</a>.</li>
<li>Intrusion prevention via <a href="http://www.fail2ban.org/">fail2ban</a> and rootkit detection via <a href="http://rkhunter.sourceforge.net">rkhunter</a>.</li>
<li>SSH configuration preventing root login and insecure password authentication</li>
<li><a href="http://tools.ietf.org/html/rfc6238">RFC6238</a> two-factor authentication compatible with <a href="http://en.wikipedia.org/wiki/Google_Authenticator">Google Authenticator</a> and various hardware tokens</li>
<li>Nightly backups to <a href="https://www.tarsnap.com/">Tarsnap</a>.</li>
<li>Git hosting via <a href="http://git.zx2c4.com/cgit/about/">cgit</a> and <a href="https://github.com/sitaramc/gitolite">gitolite</a>.</li>
<li>Read-it-later via <a href="https://www.wallabag.org/">Wallabag</a></li>
<li>A bunch of nice-to-have tools like <a href="http://mosh.mit.edu">mosh</a> and <a href="http://htop.sourceforge.net">htop</a> that make life with a server a little easier.</li>
</ul>
<p>Don’t want one or more of the above services? Comment out the relevant role in <code>site.yml</code>. Or get more granular and comment out the associated <code>include:</code> directive in one of the playbooks.</p>
<h1 id="usage">Usage</h1>
<h2 id="what-youll-need">What You’ll Need</h2>
<ol>
<li>A VPS (or bare-metal server if you wanna ball hard). My VPS is hosted at <a href="http://www.linode.com/?r=45405878277aa04ee1f1d21394285da6b43f963b">Linode</a>. You’ll probably want at least 512 MB of RAM between Apache, Solr, and PostgreSQL. Mine has 1024.</li>
<li><a href="http://www.debian.org/">64-bit Debian 8.3</a> or an equivalent Linux distribution. (You can use whatever distro you want, but deviating from Debian will require more tweaks to the playbooks. See Ansible’s different <a href="http://docs.ansible.com/ansible/list_of_packaging_modules.html">packaging</a> modules.)</li>
<li>A <a href="http://www.tarsnap.com">Tarsnap</a> account with some credit in it. You could comment this out if you want to use a different backup service. Consider paying your hosting provider for backups or using an additional backup service for redundancy.</li>
</ol>
<p>You do not need to acquire an SSL certificate.  The SSL certificates you need will be obtained from <a href="https://letsencrypt.org/">Let&#39;s Encrypt</a> automatically when you deploy your server.</p>
<h2 id="installation">Installation</h2>
<h2 id="on-the-remote-server">On the remote server</h2>
<p>The following steps are done on the remote server by <code>ssh</code>ing into it and running these commands.</p>
<h3 id="1-install-required-packages-eg-aptitude-is-required-on-debian">1. Install required packages e.g <code>aptitude</code> is required on Debian</h3>
<pre><code>apt-get install sudo python</code></pre><h3 id="2-get-a-tarsnap-machine-key">2. Get a Tarsnap machine key</h3>
<p>If you haven’t already, <a href="https://www.tarsnap.com/download.html">download and install Tarsnap</a>, or use <code>brew install tarsnap</code> if you use <a href="http://brew.sh">Homebrew</a>.</p>
<p>Create a new machine key for your server:</p>
<pre><code>tarsnap-keygen --keyfile roles/tarsnap/files/decrypted_tarsnap.key --user me@example.com --machine example.com</code></pre><p>Download a copy of this key and keep it somewhere safe!  There&#39;s no point having backups if you can&#39;t retrieve them when needed.</p>
<h3 id="3-prep-the-server">3. Prep the server</h3>
<p>For goodness sake, change the root password:</p>
<pre><code>passwd</code></pre><p>Create a user account for Ansible to do its thing through:</p>
<pre><code>useradd deploy
passwd deploy
mkdir /home/deploy</code></pre><p>Authorize your ssh key if you want passwordless ssh login (optional):</p>
<pre><code>mkdir /home/deploy/.ssh
chmod 700 /home/deploy/.ssh
nano /home/deploy/.ssh/authorized_keys
chmod 400 /home/deploy/.ssh/authorized_keys
chown deploy:deploy /home/deploy -R
echo &#39;deploy ALL=(ALL) NOPASSWD: ALL&#39; &gt; /etc/sudoers.d/deploy</code></pre><p>Your new account will be automatically set up for passwordless <code>sudo</code>. Or you can just add your <code>deploy</code> user to the sudo group.</p>
<pre><code>adduser deploy sudo</code></pre><h2 id="on-your-local-machine">On your local machine</h2>
<p>Ansible (the tool setting up your server) runs locally on your computer and sends commands to the remote server. Download this repository somewhere on your machine, either through <code>Clone or Download &gt; Download ZIP</code> above, <code>wget</code>, or <code>git</code> as below</p>
<pre><code>git clone https://github.com/sovereign/sovereign.git</code></pre><h3 id="4-configure-your-installation">4. Configure your installation</h3>
<p>Modify the settings in the <code>group_vars/sovereign</code> folder to your liking. If you want to see how they’re used in context, just search for the corresponding string.
All of the variables in <code>group_vars/sovereign</code> must be set for sovereign to function.</p>
<p>For Git hosting, copy your public key into place:</p>
<pre><code>cp ~/.ssh/id_rsa.pub roles/git/files/gitolite.pub</code></pre><p>Finally, replace the <code>host.example.net</code> in the file <code>hosts</code>. If your SSH daemon listens on a non-standard port, add a colon and the port number after the IP address. In that case you also need to add your custom port to the task <code>Set firewall rules for web traffic and SSH</code> in the file <code>roles/common/tasks/ufw.yml</code>.</p>
<h3 id="5-set-up-dns">5. Set up DNS</h3>
<p>If you’ve just bought a new domain name, point it at <a href="https://library.linode.com/dns-manager">Linode’s DNS Manager</a> or similar. Most VPS services (and even some domain registrars) offer a managed DNS service that you can use for this at no charge. If you’re using an existing domain that’s already managed elsewhere, you can probably just modify a few records.</p>
<p>Create <code>A</code> or <code>CNAME</code> records which point to your server&#39;s IP address:</p>
<ul>
<li><code>example.com</code></li>
<li><code>mail.example.com</code></li>
<li><code>www.example.com</code> (for Web hosting)</li>
<li><code>autoconfig.example.com</code> (for email client automatic configuration)</li>
<li><code>read.example.com</code> (for Wallabag)</li>
<li><code>news.example.com</code> (for Selfoss)</li>
<li><code>cloud.example.com</code> (for ownCloud)</li>
<li><code>git.example.com</code> (for cgit)</li>
</ul>
<h3 id="6-run-the-ansible-playbooks">6. Run the Ansible Playbooks</h3>
<p>First, make sure you’ve <a href="http://docs.ansible.com/intro_installation.html#getting-ansible">got Ansible 1.9.3+ installed</a>.</p>
<p>To run the whole dang thing:</p>
<pre><code>ansible-playbook -i ./hosts --ask-sudo-pass site.yml</code></pre><p>If you chose to make a passwordless sudo deploy user, you can omit the <code>--ask-sudo-pass</code> argument.</p>
<p>To run just one or more piece, use tags. I try to tag all my includes for easy isolated development. For example, to focus in on your firewall setup:</p>
<pre><code>ansible-playbook -i ./hosts --tags=ufw site.yml</code></pre><p>You might find that it fails at one point or another. This is probably because something needs to be done manually, usually because there’s no good way of automating it. Fortunately, all the tasks are clearly named so you should be able to find out where it stopped. I’ve tried to add comments where manual intervention is necessary.</p>
<p>The <code>dependencies</code> tag just installs dependencies, performing no other operations. The tasks associated with the <code>dependencies</code> tag do not rely on the user-provided settings that live in <code>group_vars/sovereign</code>. Running the playbook with the <code>dependencies</code> tag is particularly convenient for working with Docker images.</p>
<h3 id="7-finish-dns-set-up">7. Finish DNS set-up</h3>
<p>Create an <code>MX</code> record for <code>example.com</code> which assigns <code>mail.example.com</code> as the domain’s mail server.</p>
<p>To ensure your emails pass DKIM checks you need to add a <code>txt</code> record. The name field will be <code>default._domainkey.EXAMPLE.COM.</code> The value field contains the public key used by DKIM. The exact value needed can be found in the file <code>/var/lib/rspamd/dkim/EXAMPLE.COM.default.txt</code>. It will look something like this:</p>
<pre><code>v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDKKAQfMwKVx+oJripQI+Ag4uTwYnsXKjgBGtl7Tk6UMTUwhMqnitqbR/ZQEZjcNolTkNDtyKZY2Z6LqvM4KsrITpiMbkV1eX6GKczT8Lws5KXn+6BHCKULGdireTAUr3Id7mtjLrbi/E3248Pq0Zs39hkDxsDcve12WccjafJVwIDAQAB</code></pre><p>For DMARC you&#39;ll also need to add a <code>txt</code> record. The name field should be <code>_dmarc.EXAMPLE.COM</code> and the value should be <code>v=DMARC1; p=none</code>. More info on DMARC can be found <a href="https://dmarc.org">here</a>.</p>
<p>Set up SPF and reverse DNS <a href="http://sealedabstract.com/code/nsa-proof-your-e-mail-in-2-hours/">as per this post</a>. Make sure to validate that it’s all working, for example, by sending an email to <a href="mailto:check-auth@verifier.port25.com">check-auth@verifier.port25.com</a> and reviewing the report that will be emailed back to you.</p>
<h3 id="8-miscellaneous-configuration">8. Miscellaneous Configuration</h3>
<p>Sign in to the ZNC web interface and set things up to your liking. It isn’t exposed through the firewall, so you must first set up an SSH tunnel:</p>
<pre><code>ssh deploy@example.com -L 6643:localhost:6643</code></pre><p>Then proceed to <a href="http://localhost:6643">http://localhost:6643</a> in your web browser.</p>
<p>Similarly, to access the server monitoring page, use another SSH tunnel:</p>
<pre><code>ssh deploy@example.com -L 2812:localhost:2812</code></pre><p>Again proceeding to <a href="http://localhost:2812">http://localhost:2812</a> in your web browser.</p>
<p>Finally, sign into ownCloud with a new administrator account to set it
up. You should select PostgreSQL as the configuration backend. Use
<code>owncloud</code> as the database user and the database name. For the
database password ansible has created a set of random passwords for
each service and stores them in your local folder <code>secret</code>, use the
one in the file <code>owncloud_db_password</code>.</p>
<h2 id="how-to-use-your-new-personal-cloud">How To Use Your New Personal Cloud</h2>
<p>We’re collecting known-good client setups <a href="https://github.com/sovereign/sovereign/wiki/Usage">on our wiki</a>.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If you run into an errors, please check the <a href="https://github.com/sovereign/sovereign/wiki/Troubleshooting">wiki page</a>. If the problem you encountered, is not listed, please go ahead and <a href="https://github.com/sovereign/sovereign/issues/new">create an issue</a>. If you already have a bugfix and/or workaround, just put them in the issue and the wiki page.</p>
<h3 id="reboots">Reboots</h3>
<p>You will need to manually enter the password for any encrypted volumes on reboot. This is not Sovereign-specific, but rather a function of how EncFS works. This will necessitate SSHing into your machine after reboot, or accessing it via a console interface if one is available to you. Once you&#39;re in, run this:</p>
<pre><code>encfs /encrypted /decrypted --public</code></pre><p>It is possible that some daemons may need to be restarted after you enter your password for the encrypted volume(s). Some services may stall out while looking for resources that will only be available once the <code>/decrypted</code> volume is available and visible to daemon user accounts.</p>
<h1 id="irc">IRC</h1>
<p>Ask questions and provide feedback in <code>#sovereign</code> on <a href="http://freenode.net">Freenode</a>.</p>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 06 May 2020</div><div class="column">Version: 1.1.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>