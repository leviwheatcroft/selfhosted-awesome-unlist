<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Platform with iOS and Android apps to control Arduino, ESP8266, Raspberry Pi and similar microcontroller boards over the Internet."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a><ul class="navigation-list float-right"><li class="navigation-item"><a class="navigation-link" href="https://github.com/leviwheatcroft/selfhosted-awesome-unlist"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>github</a></li></ul></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>blynk-server</h1><span class="subheading"></span><div class="links"><a class="button button-outline" href="https://blynk.io/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>blynk</a><a class="button button-outline" href="https://github.com/blynkkk/blynk-server"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>Source Code</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info"><div class="github"><span class="pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>21 Apr 2020</span><span class="stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>1783</span><span class="issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>20</span></div><div class="tags"><a class="button" href="/selfhosted-awesome-unlist/tags/java.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Java</a><a class="button" href="/selfhosted-awesome-unlist/tags/miscother.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Misc/Other</a><a class="button" href="/selfhosted-awesome-unlist/tags/selfhosted.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>selfhosted</a><a class="button" href="/selfhosted-awesome-unlist/tags/docker.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Docker</a></div></div></div></div></div></section><article><div class="container"><div class="row"><div class="column"><h1 id="what-is-blynk">What is Blynk?</h1>
<p>Blynk is a platform with iOS and Android apps to control Arduino, ESP8266, Raspberry Pi and the likes over the Internet.<br>You can easily build graphic interfaces for all your projects by simply dragging and dropping widgets.
If you need more information, please follow these links:</p>
<ul>
<li><a href="https://www.blynk.io">Blynk site</a></li>
<li><a href="http://docs.blynk.cc">Blynk docs</a></li>
<li><a href="https://community.blynk.cc">Blynk community</a></li>
<li><a href="https://examples.blynk.cc">Blynk Examples generator</a></li>
<li><a href="http://www.fb.com/blynkapp">Facebook</a></li>
<li><a href="http://twitter.com/blynk_app">Twitter</a></li>
<li><a href="https://itunes.apple.com/us/app/blynk-control-arduino-raspberry/id808760481?ls=1&amp;mt=8">App Store</a></li>
<li><a href="https://play.google.com/store/apps/details?id=cc.blynk">Google Play</a></li>
<li><a href="https://github.com/blynkkk/blynk-library">Blynk library</a></li>
<li><a href="https://www.kickstarter.com/projects/167134865/blynk-build-an-app-for-your-arduino-project-in-5-m/description">Kickstarter</a></li>
</ul>
<p><img src="https://github.com/blynkkk/blynk-server/blob/master/docs/overview/dash_settings.png" alt="Dashboard settings">
<img src="https://github.com/blynkkk/blynk-server/blob/master/docs/overview/widgets_box.png" alt="Widgets Box">
<img src="https://github.com/blynkkk/blynk-server/blob/master/docs/overview/dash.png" alt="Dashboard">
<img src="https://github.com/blynkkk/blynk-server/blob/master/docs/overview/dash2.png" alt="Dashboard2"></p>
<h1 id="content">Content</h1>
<ul>
<li><a href="#blynk-server">Download</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#quick-local-server-setup">Quick Local Server setup</a></li>
<li><a href="#enabling-mail-on-local-server">Enabling mail on Local server</a></li>
<li><a href="#quick-local-server-setup-on-raspberry-pi">Quick local server setup on Raspberry PI</a></li>
<li><a href="#docker-container-setup">Docker container setup</a></li>
<li><a href="#enabling-server-auto-restart-on-unix-like-systems">Enabling server auto restart on unix-like systems</a></li>
<li><a href="#enabling-server-auto-restart-on-windows">Enabling server auto restart on Windows</a></li>
<li><a href="#update-instruction-for-unix-like-systems">Update instruction for unix-like systems</a></li>
<li><a href="#update-instruction-for-windows">Update instruction for Windows</a></li>
<li><a href="#app-and-sketch-changes">App and sketch changes for Local Server</a></li>
<li><a href="#advanced-local-server-setup">Advanced local server setup</a></li>
<li><a href="#administration-ui">Administration UI</a></li>
<li><a href="#https-restful">HTTP/S RESTful API</a></li>
<li><a href="#enabling-sms-on-local-server">Enabling sms on local server</a></li>
<li><a href="#enabling-raw-data-storage">Enabling raw data storage</a></li>
<li><a href="#automatic-lets-encrypt-certificates-generation">Automatic Let&#39;s Encrypt Certificates</a></li>
<li><a href="#manual-lets-encrypt-ssltls-certificates">Manual Let&#39;s Encrypt SSL/TLS Certificates</a></li>
<li><a href="#generate-own-ssl-certificates">Generate own SSL certificates</a></li>
<li><a href="#install-java-for-ubuntu">Install java for Ubuntu</a></li>
<li><a href="#how-blynk-works">How Blynk Works?</a></li>
<li><a href="#blynk-protocol">Blynk Protocol</a></li>
</ul>
<h1 id="getting-started">GETTING STARTED</h1>
<h2 id="blynk-server">Blynk server</h2>
<p>Blynk Server is an Open-Source <a href="https://github.com/netty/netty">Netty</a> based Java server, responsible for forwarding 
messages between Blynk mobile application and various microcontroller boards and SBCs (i.e. Arduino, Raspberry Pi. etc).</p>
<p><strong>Download latest server build <a href="https://github.com/blynkkk/blynk-server/releases">here</a>.</strong></p>
<p><a href="https://github.com/blynkkk/blynk-server/releases/latest"><img src="https://img.shields.io/github/release/blynkkk/blynk-server.svg" alt="GitHub version"></a>
<a href="https://github.com/blynkkk/blynk-server/releases/latest"><img src="https://img.shields.io/github/downloads/blynkkk/blynk-server/total.svg" alt="GitHub download"></a>
<a href="https://travis-ci.org/blynkkk/blynk-server"> <img src="https://travis-ci.org/blynkkk/blynk-server.svg?branch=master" alt="Build Status"></a></p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Java 8/11 required (OpenJDK, Oracle) </li>
<li>Any OS that can run java </li>
<li>At least 30 MB of RAM (could be less with tuning)</li>
<li>Open ports 9443 (for app and hardware with ssl), 8080 (for hardware without ssl)</li>
</ul>
<p><a href="#install-java-for-ubuntu">Ubuntu java installation instruction</a>.</p>
<p>For Windows download Java <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html">here</a> and install. </p>
<h2 id="quick-local-server-setup">Quick local server setup</h2>
<ul>
<li><p>Make sure you are using Java 11</p>
<pre><code>  java -version
  Output: java version &quot;11&quot;</code></pre></li>
<li><p>Run the server on default &#39;hardware port 8080&#39; and default &#39;application port 9443&#39; (SSL port)</p>
<pre><code>  java -jar server-0.41.12.jar -dataFolder /path</code></pre></li>
</ul>
<p>That&#39;s it! </p>
<p><strong>NOTE: <code>/path</code> should be real existing path to folder where you want to store all your data.</strong></p>
<ul>
<li><p>As an output you should see something like that:</p>
<pre><code>  Blynk Server successfully started.
  All server output is stored in current folder in &#39;logs/blynk.log&#39; file.</code></pre></li>
</ul>
<h3 id="enabling-mail-on-local-server">Enabling mail on Local server</h3>
<p>To enable mail notifications on Local server you need to provide your own mail credentials. Create file <code>mail.properties</code> within same folder where <code>server.jar</code> is.
Mail properties:</p>
<pre><code>    mail.smtp.auth=true
    mail.smtp.starttls.enable=true
    mail.smtp.host=smtp.gmail.com
    mail.smtp.port=587
    mail.smtp.username=YOUR_EMAIL_HERE
    mail.smtp.password=YOUR_EMAIL_PASS_HERE</code></pre><p>Find example <a href="https://github.com/blynkkk/blynk-server/blob/master/server/notifications/email/src/main/resources/mail.properties">here</a>.</p>
<p>WARNING : only gmail accounts are allowed.</p>
<p>NOTE : you&#39;ll need to setup Gmail to allow less secured applications.
Go <a href="https://www.google.com/settings/security/lesssecureapps">here</a> and then click &quot;Allow less secure apps&quot;.</p>
<h2 id="quick-local-server-setup-on-raspberry-pi">Quick local server setup on Raspberry PI</h2>
<ul>
<li><p>Login to Raspberry Pi via ssh;</p>
</li>
<li><p>Install java 8: </p>
<pre><code>  sudo apt install openjdk-8-jdk openjdk-8-jre</code></pre></li>
<li><p>Make sure you are using Java 8</p>
<pre><code>  java -version
  Output: java version &quot;1.8&quot;</code></pre></li>
<li><p>Download Blynk server jar file (or manually copy it to Raspberry Pi via ssh and scp command): </p>
<pre><code>  wget &quot;https://github.com/blynkkk/blynk-server/releases/download/v0.41.12/server-0.41.12-java8.jar&quot;</code></pre></li>
<li><p>Run the server on default &#39;hardware port 8080&#39; and default &#39;application port 9443&#39; (SSL port)</p>
<pre><code>  java -jar server-0.41.12-java8.jar -dataFolder /home/pi/Blynk</code></pre></li>
</ul>
<p>That&#39;s it! </p>
<ul>
<li><p>As output you will see something like that:</p>
<pre><code>  Blynk Server successfully started.
  All server output is stored in current folder in &#39;logs/blynk.log&#39; file.</code></pre></li>
</ul>
<h2 id="docker-container-setup">Docker container setup</h2>
<h3 id="quick-launch">Quick Launch</h3>
<ul>
<li><p>Install <a href="https://docs.docker.com/install/">Docker</a></p>
</li>
<li><p>Run Docker container</p>
<pre><code>  docker run -p 8080:8080 -p 9443:9443 mpherg/blynk-server</code></pre></li>
</ul>
<h3 id="full-customisation">Full customisation</h3>
<ul>
<li>Check <a href="server/Docker">README</a> in docker folder</li>
</ul>
<h2 id="enabling-server-auto-restart-on-unix-like-systems">Enabling server auto restart on unix-like systems</h2>
<ul>
<li><p>To enable server auto restart find /etc/rc.local file and add:</p>
<pre><code>  java -jar /home/pi/server-0.41.12-java8.jar -dataFolder /home/pi/Blynk &amp;</code></pre></li>
<li><p>Or if the approach above doesn&#39;t work, execute </p>
<pre><code>  crontab -e</code></pre></li>
</ul>
<p>add the following line</p>
<pre><code>    @reboot java -jar /home/pi/server-0.41.12-java8.jar -dataFolder /home/pi/Blynk &amp;</code></pre><p>save and exit.</p>
<h2 id="enabling-server-auto-restart-on-windows">Enabling server auto restart on Windows</h2>
<ul>
<li><p>Create bat file:</p>
<pre><code>  start-blynk.bat</code></pre></li>
<li><p>Put in it one line: </p>
<pre><code>  java -jar server-0.41.12.jar -dataFolder /home/pi/Blynk</code></pre></li>
<li><p>Put bat file to windows startup folder</p>
</li>
</ul>
<p>You can also use <a href="https://github.com/blynkkk/blynk-server/tree/master/scripts/win">this</a> script to run server.</p>
<h2 id="update-instruction-for-unix-like-systems">Update instruction for unix-like systems</h2>
<p><strong>IMPORTANT</strong>
Server should be always updated before you update Blynk App. To update your server to a newer version you would need to kill old process and start a new one.</p>
<ul>
<li><p>Find process id of Blynk server</p>
<pre><code>  ps -aux | grep java</code></pre></li>
<li><p>You should see something like that</p>
<pre><code>  username   10539  1.0 12.1 3325808 428948 pts/76 Sl   Jan22   9:11 java -jar server-0.41.12.jar   </code></pre></li>
<li><p>Kill the old process</p>
<pre><code>  kill 10539</code></pre></li>
</ul>
<p>10539 - blynk server process id from command output above.</p>
<ul>
<li>Start new server <a href="#quick-local-server-setup">as usual</a></li>
</ul>
<p>After this steps you can update Blynk app. Server version downgrade is not supported. </p>
<p><strong>WARNING!</strong>
Please <strong>do not</strong> revert your server to lower versions. You may loose all of your data.</p>
<h2 id="update-instruction-for-windows">Update instruction for Windows</h2>
<ul>
<li><p>Open Task Manager;</p>
</li>
<li><p>Find Java process;</p>
</li>
<li><p>Stop process;</p>
</li>
<li><p>Start new server <a href="#quick-local-server-setup">as usual</a></p>
</li>
</ul>
<h2 id="app-and-sketch-changes">App and sketch changes</h2>
<ul>
<li>Specify custom server path in your application</li>
</ul>
<p><img src="https://github.com/blynkkk/blynk-server/blob/master/docs/login.png" alt="Custom server icon">
<img src="https://github.com/blynkkk/blynk-server/blob/master/docs/custom.png" alt="Server properties menu"></p>
<ul>
<li><p>Change your ethernet sketch from</p>
<pre><code>  Blynk.begin(auth);</code></pre><p>  to</p>
<pre><code>  Blynk.begin(auth, &quot;your_host&quot;, 8080);</code></pre><p>  or to</p>
<pre><code>  Blynk.begin(auth, IPAddress(xxx,xxx,xxx,xxx), 8080);</code></pre></li>
<li><p>Change your WIFI sketch from</p>
<pre><code>  Blynk.begin(auth, SSID, pass));</code></pre><p>  to</p>
<pre><code>  Blynk.begin(auth, SSID, pass, &quot;your_host&quot;, 8080);</code></pre><p>  or to</p>
<pre><code>  Blynk.begin(auth, SSID, pass, IPAddress(XXX,XXX,XXX,XXX), 8080);</code></pre></li>
<li><p>Change your rasp PI javascript from</p>
<pre><code>  var blynk = new Blynk.Blynk(AUTH, options = {connector : new Blynk.TcpClient()});</code></pre><p>  to</p>
<pre><code>  var blynk = new Blynk.Blynk(AUTH, options= {addr:&quot;xxx.xxx.xxx.xxx&quot;, port:8080});</code></pre></li>
<li><p>or in case of USB when running blynk-ser.sh provide &#39;-s&#39; option with address of your local server</p>
<pre><code>  ./blynk-ser.sh -s you_host_or_IP</code></pre></li>
</ul>
<p><strong>IMPORTANT</strong> 
Blynk is being constantly developed. Mobile apps and server are updated often. To avoid problems during updates either turn off auto-update for Blynk app, or update both local server and blynk app at same time to avoid possible migration issues.</p>
<p><strong>IMPORTANT</strong> 
Blynk local server is different from  Blynk Cloud server. They are not related at all. You have to create new account when using Blynk local server.</p>
<h2 id="advanced-local-server-setup">Advanced local server setup</h2>
<p>For more flexibility you can extend server with more options by creating <code>server.properties</code> file in same folder as <code>server.jar</code>. 
Example could be found <a href="https://github.com/blynkkk/blynk-server/blob/master/server/core/src/main/resources/server.properties">here</a>.
You could also specify any path to <code>server.properties</code> file via command line argument <code>-serverConfig</code>. You can 
do the same with <code>mail.properties</code> via <code>-mailConfig</code> and <code>sms.properties</code> via <code>-smsConfig</code>.</p>
<p>For example:</p>
<pre><code>java -jar server-0.41.12-java8.jar -dataFolder /home/pi/Blynk -serverConfig /home/pi/someFolder/server.properties</code></pre><p>Available server options:</p>
<ul>
<li><p>Blynk app, https, web sockets, admin port</p>
<pre><code>  https.port=9443</code></pre></li>
</ul>
<ul>
<li><p>Http, hardware and web sockets port</p>
<pre><code>  http.port=8080</code></pre></li>
</ul>
<ul>
<li><p>For simplicity Blynk already provides server jar with built in SSL certificates, so you have working server out of the box via SSL/TLS sockets. But as certificate and it&#39;s private key are in public this is totally not secure. So in order to fix that you need to provide your own certificates. And change below properties with path to your cert. and private key and it&#39;s password. See how to generate self-signed certificates <a href="#generate-ssl-certificates">here</a></p>
<pre><code>  #points to cert and key that placed in same folder as running jar.

  server.ssl.cert=./server_embedded.crt
  server.ssl.key=./server_embedded.pem
  server.ssl.key.pass=pupkin123</code></pre></li>
</ul>
<ul>
<li><p>User profiles folder. Folder in which all users profiles will be stored. By default System.getProperty(&quot;java.io.tmpdir&quot;)/blynk used. Will be created if not exists</p>
<pre><code>  data.folder=/tmp/blynk</code></pre></li>
</ul>
<ul>
<li><p>Folder for all application logs. Will be created if it doesn&#39;t exist. &quot;.&quot; is dir from which you are running script.</p>
<pre><code>  logs.folder=./logs</code></pre></li>
</ul>
<ul>
<li><p>Log debug level. Possible values: trace|debug|info|error. Defines how precise logging will be. From left to right -&gt; maximum logging to minimum</p>
<pre><code>  log.level=trace</code></pre></li>
</ul>
<ul>
<li><p>Maximum allowed number of user dashboards.</p>
<pre><code>  user.dashboard.max.limit=100</code></pre></li>
</ul>
<ul>
<li><p>100 Req/sec rate limit per user. You also may want to extend this limit on <a href="https://github.com/blynkkk/blynk-library/blob/f4e132652906d63d683abeed89f5d6ebe369e37a/Blynk/BlynkConfig.h#L42">hardware side</a>.</p>
<pre><code>  user.message.quota.limit=100</code></pre></li>
</ul>
<ul>
<li><p>this setting defines how often you can send mail/tweet/push or any other notification. Specified in seconds</p>
<pre><code>  notifications.frequency.user.quota.limit=60</code></pre></li>
</ul>
<ul>
<li><p>Maximum allowed user profile size. In Kb&#39;s.</p>
<pre><code>  user.profile.max.size=128</code></pre></li>
</ul>
<ul>
<li><p>Number of strings to store in terminal widget (terminal history data)</p>
<pre><code>  terminal.strings.pool.size=25</code></pre></li>
</ul>
<ul>
<li><p>Maximum allowed number of notification queue. Queue responsible for processing email, pushes, twits sending. Because of performance issue - those queue is processed in separate thread, this is required due to blocking nature of all above operations. Usually limit shouldn&#39;t be reached</p>
<pre><code>  notifications.queue.limit=5000</code></pre></li>
</ul>
<ul>
<li><p>Number of threads for performing blocking operations - push, twits, emails, db queries. Recommended to hold this value low unless you have to perform a lot of blocking operations.</p>
<pre><code>  blocking.processor.thread.pool.limit=6</code></pre></li>
</ul>
<ul>
<li><p>Period for flushing all user DB to disk. In millis</p>
<pre><code>  profile.save.worker.period=60000</code></pre></li>
<li><p>Specifies maximum period of time when hardware socket could be idle. After which socket will be closed due to non activity. In seconds. Leave it empty for infinity timeout</p>
<pre><code>  hard.socket.idle.timeout=15</code></pre></li>
<li><p>Mostly required for local servers setup in case user want to log raw data in CSV format. See [raw data] (#raw-data-storage) section for more info.</p>
<pre><code>  enable.raw.data.store=true</code></pre></li>
<li><p>Url for opening admin page. Must start from &quot;/&quot;. For &quot;/admin&quot; url path will look like that &quot;<a href="https://127.0.0.1:9443/admin&quot;">https://127.0.0.1:9443/admin&quot;</a>. </p>
<pre><code>  admin.rootPath=/admin</code></pre></li>
<li><p>Comma separated list of administrator IPs. Allow access to admin UI only for those IPs. You may set it for 0.0.0.0/0 to allow access for all. You may use CIDR notation. For instance, 192.168.0.53/24.</p>
<pre><code>  allowed.administrator.ips=0.0.0.0/0</code></pre></li>
<li><p>Default admin name and password. Will be created on initial server start</p>
<pre><code>  admin.email=admin@blynk.cc
  admin.pass=admin</code></pre></li>
<li><p>Host for reset password redirect and certificate generation. By default current server IP is taken from &quot;eth&quot; network interface. Could be replaced with more friendly hostname. It is recommended to override this property with your server IP to avoid possible problems of host resolving.</p>
<pre><code>  server.host=blynk-cloud.com</code></pre></li>
<li><p>Email used for certificate registration, could be omitted in case you already specified it in mail.properties.</p>
<pre><code>  contact.email=pupkin@gmail.com</code></pre></li>
</ul>
<h2 id="administration-ui">Administration UI</h2>
<p>Blynk server provides administration panel where you can monitor your server. It is accessible at this URL:</p>
<pre><code>    https://your_ip:9443/admin</code></pre><p><img src="https://github.com/blynkkk/blynk-server/blob/master/docs/admin_panel.png" alt="Administration UI"></p>
<p><strong>WARNING</strong>
Please change default admin password and name right after login to admin page. <strong>THIS IS SECURITY MEASURE</strong>.</p>
<p><strong>WARNING</strong>
Default <code>allowed.administrator.ips</code> setting allows access for everyone. In other words, 
administration page available from any other computer. Please restrict access to it via property <code>allowed.administrator.ips</code>.</p>
<h3 id="turn-off-chrome-https-warning-on-localhost">Turn off chrome https warning on localhost</h3>
<ul>
<li><p>Paste in chrome </p>
<pre><code>  chrome://flags/#allow-insecure-localhost</code></pre></li>
<li><p>You should see highlighted text saying: &quot;Allow invalid certificates for resources loaded from localhost&quot;. Click enable.</p>
</li>
</ul>
<h2 id="https-restful">HTTP/S RESTful</h2>
<p>Blynk HTTP/S RESTful API allows to easily read and write values to/from Pins in Blynk apps and Hardware. 
Http API description could be found <a href="http://docs.blynkapi.apiary.io">here</a>.</p>
<h3 id="enabling-sms-on-local-server">Enabling sms on local server</h3>
<p>To enable SMS notifications on Local Server you need to provide credentials for SMS gateway (currently Blynk server
supports only 1 provider - <a href="https://www.nexmo.com/">Nexmo</a>. You need to create file <code>sms.properties</code> 
within same folder where server.jar is.</p>
<pre><code>    nexmo.api.key=
    nexmo.api.secret=</code></pre><p>And fill in the above properties with the credentials you&#39;ll get from Nexmo. (Account -&gt; Settings -&gt; API settings).
You can also send SMS over email if your cell provider supports that. See <a href="http://community.blynk.cc/t/sms-notification-for-important-alert/2542">discussion</a> for more details.</p>
<h2 id="enabling-raw-data-storage">Enabling raw data storage</h2>
<p>By default raw data storage is disabled (as it consumes disk space a lot). 
When you enable it, every <code>Blynk.virtualWrite</code> command will be saved to DB.
You will need to install PostgreSQL Database (<strong>minimum required version is 9.5</strong>) to enable this functionality:</p>
<h4 id="1-enabling-raw-data-on-server">1. Enabling raw data on server</h4>
<p>Enable raw data in <code>server.properties</code> : </p>
<pre><code>    enable.db=true
    enable.raw.db.data.store=true</code></pre><h4 id="2-install-postgresql-option-a">2. Install PostgreSQL. Option A</h4>
<pre><code>    sudo sh -c &#39;echo &quot;deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg main&quot; &gt;&gt; /etc/apt/sources.list.d/pgdg.list&#39;
    wget -q https://www.postgresql.org/media/keys/ACCC4CF8.asc -O - | sudo apt-key add -

    sudo apt-get update
    sudo apt-get install postgresql postgresql-contrib</code></pre><h4 id="2-install-postgresql--option-b">2. Install PostgreSQL.  Option B</h4>
<pre><code>    sudo apt-get update
    apt-get --no-install-recommends install postgresql-9.6 postgresql-contrib-9.6</code></pre><h4 id="3-download-blynk-db-script">3. Download Blynk DB script</h4>
<pre><code>    wget https://raw.githubusercontent.com/blynkkk/blynk-server/master/server/core/src/main/resources/create_schema.sql
    wget https://raw.githubusercontent.com/blynkkk/blynk-server/master/server/core/src/main/resources/reporting_schema.sql</code></pre><h4 id="4-move-create_schemasql-and-reporting_schemasql-to-temp-folder-to-avoid-permission-problems">4. Move create_schema.sql and reporting_schema.sql to temp folder (to avoid permission problems)</h4>
<pre><code>    mv create_schema.sql /tmp
    mv reporting_schema.sql /tmp</code></pre><p>Result:  </p>
<pre><code>    /tmp/create_schema.sql
    /tmp/reporting_schema.sql</code></pre><p>Copy it to clipboard from your console.</p>
<h4 id="5-connect-to-postgresql">5. Connect to PostgreSQL</h4>
<pre><code>    sudo su - postgres
    psql</code></pre><h4 id="6-create-blynk-db-and-reporting-db-test-user-and-tables">6. Create Blynk DB and Reporting DB, test user and tables</h4>
<pre><code>    \i /tmp/create_schema.sql
    \i /tmp/reporting_schema.sql</code></pre><p><code>/tmp/create_schema.sql</code> - is path from step 4.</p>
<p>You should see next output:</p>
<pre><code>    postgres=# \i /tmp/create_schema.sql
    CREATE DATABASE
    You are now connected to database &quot;blynk&quot; as user &quot;postgres&quot;.
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE TABLE
    CREATE ROLE
    GRANT
    GRANT</code></pre><h4 id="quit">Quit</h4>
<pre><code>    \q</code></pre><p>Now start your server and you should see next text in <code>postgres.log</code> file : </p>
<pre><code>    2017-03-02 16:17:18.367 - DB url : jdbc:postgresql://localhost:5432/blynk?tcpKeepAlive=true&amp;socketTimeout=150
    2017-03-02 16:17:18.367 - DB user : test
    2017-03-02 16:17:18.367 - Connecting to DB...
    2017-03-02 16:17:18.455 - Connected to database successfully.</code></pre><p>WARNING:
Raw data may consume your disk space very quickly!</p>
<h3 id="csv-data-format">CSV data format</h3>
<p>Data format is:</p>
<pre><code>    value,timestamp,deviceId</code></pre><p>For example:</p>
<pre><code>    10,1438022081332,0</code></pre><p>Where <code>10</code> - value of pin.
<code>1438022081332</code> - the difference, measured in milliseconds, between the current time and midnight, January 1, 1970 UTC.
To display the date/time in excel you may use formula:</p>
<pre><code>    =((COLUMN/(60*60*24)/1000+25569))</code></pre><p><code>0</code> - device id</p>
<h3 id="automatic-lets-encrypt-certificates-generation">Automatic Let&#39;s Encrypt certificates generation</h3>
<p>Latest Blynk server has super cool feature - automatic Let&#39;s Encrypt certificates generation. 
However, it has few requirements: </p>
<ul>
<li><p>Add <code>server.host</code> property in <code>server.properties</code> file. 
For example : </p>
<pre><code>  server.host=myhost.com</code></pre></li>
</ul>
<p>IP is not supported, this is the limitation of Let&#39;s Encrypt. Also have in mind that <code>myhost.com</code> 
should be resolved by public DNS severs.</p>
<ul>
<li><p>Add <code>contact.email</code> property in <code>server.properties</code>. For example : </p>
<pre><code>  contact.email=test@gmail.com</code></pre></li>
<li><p>You need to start server on port 80 (requires root or admin rights) or 
make <a href="#port-forwarding-for-https-api">port forwarding</a> to default Blynk HTTP port - 8080.</p>
</li>
</ul>
<p>That&#39;s it! Run server as regular and certificates will be generated automatically.</p>
<p><img src="https://gifyu.com/images/certs.gif" alt=""></p>
<h3 id="manual-lets-encrypt-ssltls-certificates">Manual Let&#39;s Encrypt SSL/TLS Certificates</h3>
<ul>
<li><p>First install <a href="https://github.com/certbot/certbot">certbot</a> on your server (machine where you going to run Blynk Server)</p>
<pre><code>  wget https://dl.eff.org/certbot-auto
  chmod a+x certbot-auto</code></pre></li>
<li><p>Generate and verify certificates (your server should be connected to internet and have open 80/443 ports)</p>
<pre><code>  ./certbot-auto certonly --agree-tos --email YOUR_EMAIL --standalone -d YOUR_HOST</code></pre></li>
</ul>
<p>For example </p>
<pre><code>    ./certbot-auto certonly --agree-tos --email pupkin@blynk.cc --standalone -d blynk.cc</code></pre><ul>
<li><p>Then add to your <code>server.properties</code> file (in folder with server.jar)</p>
<pre><code>  server.ssl.cert=/etc/letsencrypt/live/YOUR_HOST/fullchain.pem
  server.ssl.key=/etc/letsencrypt/live/YOUR_HOST/privkey.pem
  server.ssl.key.pass=</code></pre></li>
</ul>
<h3 id="generate-own-ssl-certificates">Generate own SSL certificates</h3>
<ul>
<li><p>Generate self-signed certificate and key</p>
<pre><code>  openssl req -x509 -nodes -days 1825 -newkey rsa:2048 -keyout server.key -out server.crt</code></pre></li>
<li><p>Convert server.key to PKCS#8 private key file in PEM format</p>
<pre><code>  openssl pkcs8 -topk8 -inform PEM -outform PEM -in server.key -out server.pem</code></pre></li>
</ul>
<p>If you connect hardware with <a href="https://github.com/blynkkk/blynk-library/tree/master/scripts">USB script</a> you have to provide an option &#39;-s&#39; pointing to &quot;common name&quot; (hostname) you did specified during certificate generation.</p>
<p>As an output you&#39;ll retrieve server.crt and server.pem files that you need to provide for server.ssl properties.</p>
<h3 id="install-java-for-ubuntu">Install java for Ubuntu</h3>
<pre><code>    sudo add-apt-repository ppa:openjdk-r/ppa \
    &amp;&amp; sudo apt-get update -q \
    &amp;&amp; sudo apt install -y openjdk-11-jdk</code></pre><p>or if above doesn&#39;t work:</p>
<pre><code>    sudo apt-add-repository ppa:webupd8team/java
    sudo apt-get update
    sudo apt-get install oracle-java8-installer</code></pre><h3 id="port-forwarding-for-https-api">Port forwarding for HTTP/S API</h3>
<pre><code>    sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080
    sudo iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-port 9443</code></pre><h3 id="enabling-qr-generation-on-server">Enabling QR generation on server</h3>
<pre><code>    sudo apt-get install libxrender1</code></pre><h3 id="behind-wifi-router">Behind wifi router</h3>
<p>If you want to run Blynk server behind WiFi-router and want it to be accessible from the Internet, you have to add port-forwarding rule on your router. This is required in order to forward all of the requests that come to the router within the local network to Blynk server.</p>
<h3 id="how-to-build">How to build</h3>
<p>Blynk has a bunch of integration tests that require DB, so you have to skip tests during build.</p>
<pre><code>    mvn clean install -Dmaven.test.skip=true</code></pre><h3 id="how-blynk-works">How Blynk Works?</h3>
<p>When hardware connects to Blynk cloud it opens either keep-alive ssl/tls connection on port 443 (9443 for local servers) or keep-alive plain
tcp/ip connection on port 8080. Blynk app opens mutual ssl/tls connection to Blynk Cloud on port 443 (9443 for local servers).
Blynk Cloud is responsible for forwarding messages between hardware and app. In both (app and hardware) connections Blynk uses 
own binary protocol described below.</p>
<h3 id="blynk-protocol">Blynk protocol</h3>
<h4 id="hardware-side-protocol">Hardware side protocol</h4>
<p>Blynk transfers binary messages between the server and the hardware with the following structure:</p>
<table>
<thead>
<tr>
<th align="center">Command</th>
<th align="center">Message Id</th>
<th align="center">Length/Status</th>
<th align="center">Body</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1 byte</td>
<td align="center">2 bytes</td>
<td align="center">2 bytes</td>
<td align="center">Variable</td>
</tr>
</tbody></table>
<p>Command and Status definitions: <a href="https://github.com/blynkkk/blynk-library/blob/7e942d661bc54ded310bf5d00edee737d0ca44d7/src/Blynk/BlynkProtocolDefs.h">BlynkProtocolDefs.h</a></p>
<h4 id="mobile-app-side-protocol">Mobile app side protocol</h4>
<p>Blynk transfers binary messages between the server and mobile app with the following structure:</p>
<table>
<thead>
<tr>
<th align="center">Command</th>
<th align="center">Message Id</th>
<th align="center">Length/Status</th>
<th align="center">Body</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1 byte</td>
<td align="center">2 bytes</td>
<td align="center">4 bytes</td>
<td align="center">Variable</td>
</tr>
</tbody></table>
<h4 id="websockets-web-side-protocol">Websockets web side protocol</h4>
<p>Blynk transfers binary messages between the server and websockets (for web) with the following structure:</p>
<table>
<thead>
<tr>
<th align="center">Websocket header</th>
<th align="center">Command</th>
<th align="center">Message Id</th>
<th align="center">Body</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center">1 byte</td>
<td align="center">2 bytes</td>
<td align="center">Variable</td>
</tr>
</tbody></table>
<p>When command code == 0, than message structure is next:</p>
<table>
<thead>
<tr>
<th align="center">Websocket header</th>
<th align="center">Command</th>
<th align="center">Message Id</th>
<th align="center">Response code</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center">1 byte</td>
<td align="center">2 bytes</td>
<td align="center">4 bytes</td>
</tr>
</tbody></table>
<p><a href="https://github.com/blynkkk/blynk-server/blob/master/server/core/src/main/java/cc/blynk/server/core/protocol/enums/Response.java#L12">Possible response codes</a>.
<a href="https://github.com/blynkkk/blynk-server/blob/master/server/core/src/main/java/cc/blynk/server/core/protocol/enums/Command.java#L12">Possible command codes</a></p>
<p>Message Id and Length are <a href="http://en.wikipedia.org/wiki/Endianness#Big-endian">big endian</a>.
Body has a command-specific format.</p>
<h2 id="licensing">Licensing</h2>
<p><a href="https://github.com/blynkkk/blynk-server/blob/master/license.txt">GNU GPL license</a></p>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 02 May 2020</div><div class="column">Version: 1.0.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>