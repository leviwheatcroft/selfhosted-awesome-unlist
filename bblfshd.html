<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Self-hosted server for source code parsing. It can parse any file, in any supported language, extract an Abstract Syntax Tree from it, and convert it to a Universal Abstract Syntax Tree which can enable further analysis and transformation."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body class="project"><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>bblfshd</h1><span class="subheading">Self-hosted server for source code parsing. It can parse any file, in any supported language, extract an Abstract Syntax Tree from it, and convert it to a Universal Abstract Syntax Tree which can enable further analysis and transformation.</span><div class="links"><a class="button button-outline" href="https://github.com/bblfsh/bblfshd"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>Babelfish</a></div></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info statistics"><span class="stat pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>07 Nov 2019</span><span class="stat stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>271</span><span class="stat issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>30</span></div></div></div><div class="row"><div class="column"><div class="info tags"><a class="tag" href="/selfhosted-awesome-unlist/tags/go.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">90</span>go</a><span class="tag"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bookmark"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg><span class="count">1</span>ast</span><span class="tag"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bookmark"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg><span class="count">1</span>babelfish</span><span class="tag"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bookmark"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg><span class="count">1</span>code-analysis</span><span class="tag"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bookmark"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg><span class="count">1</span>parser</span><a class="tag" href="/selfhosted-awesome-unlist/tags/server.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">17</span>server</a><span class="tag"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bookmark"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg><span class="count">1</span>uast</span><a class="tag" href="/selfhosted-awesome-unlist/tags/software-development.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">68</span>software development</a><a class="tag" href="/selfhosted-awesome-unlist/tags/selfhosted.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">943</span>selfhosted</a><a class="tag" href="/selfhosted-awesome-unlist/tags/docker.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg><span class="count">328</span>docker</a></div></div></div></div></section><article><div class="container"><div class="row"><div class="column">
<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-bblfshd----" class="anchor" aria-hidden="true" href="#bblfshd----"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bblfshd <a href="https://travis-ci.org/bblfsh/bblfshd" rel="nofollow"><img src="https://camo.githubusercontent.com/b8b5335b39303163a8164a4cb829d7b6137ce015/68747470733a2f2f7472617669732d63692e6f72672f62626c6673682f62626c667368642e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/bblfsh/bblfshd.svg?branch=master" style="max-width:100%;"></a> <a href="https://codecov.io/gh/bblfsh/bblfshd" rel="nofollow"><img src="https://camo.githubusercontent.com/4b59b56e17cf97225bcd4f0ae2a42d9b3fd2a642/68747470733a2f2f636f6465636f762e696f2f67682f62626c6673682f62626c667368642f6272616e63682f6d61737465722f67726170682f62616467652e737667" alt="codecov" data-canonical-src="https://codecov.io/gh/bblfsh/bblfshd/branch/master/graph/badge.svg" style="max-width:100%;"></a> <a href="https://github.com/bblfsh/bblfshd/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/e7264ef0474c6b493d24d9a505e63d20c63b4000/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d47504c2d2d332e302d626c75652e737667" alt="license" data-canonical-src="https://img.shields.io/badge/license-GPL--3.0-blue.svg" style="max-width:100%;"></a> <a href="https://github.com/bblfsh/bblfshd/releases"><img src="https://camo.githubusercontent.com/5629305aee577f54acea3526361f7da9c422af2c/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652f62626c6673682f62626c667368642e737667" alt="GitHub release" data-canonical-src="https://img.shields.io/github/release/bblfsh/bblfshd.svg" style="max-width:100%;"></a></h1>
<p>This repository contains bblfsh daemon (<em>bblfshd</em>), which includes the
runtime that runs the driver in <em>containers</em> and the bblfshctl, a cli tool used
to control the installed drivers and query the status of the daemon.</p>
<p>Drivers are implemented as Docker images, each having their own repository in the
<a href="https://github.com/search?q=topic%3Adriver+org%3Abblfsh&amp;type=Repositories"><code>bblfsh</code> organization</a>
on GitHub. For more information, see <a href="https://doc.bblf.sh/writing-a-driver/babelfish-sdk.html" rel="nofollow">bblfsh SDK documentation</a>.</p>
<h2><a id="user-content-getting-started" class="anchor" aria-hidden="true" href="#getting-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting Started</h2>
<p>See the <a href="https://doc.bblf.sh/using-babelfish/getting-started.html" rel="nofollow">Getting Started</a> guide.</p>
<h3><a id="user-content-quick-start" class="anchor" aria-hidden="true" href="#quick-start"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Quick start</h3>
<p>This project is now part of <a href="https://sourced.tech/engine" rel="nofollow">source{d} Engine</a>,
which provides the simplest way to get started with a single command.
Visit <a href="https://sourced.tech/engine" rel="nofollow">sourced.tech/engine</a> for more information.</p>
<h4><a id="user-content-rootless-mode" class="anchor" aria-hidden="true" href="#rootless-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rootless mode</h4>
<p>The recommended way to run <em>bblfshd</em> by itself is using Docker:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd \
  -p 9432:9432 \
  -v /var/lib/bblfshd:/var/lib/bblfshd \
  -v /proc:/newproc \
  --security-opt seccomp=./bblfshd-seccomp.json \
  bblfsh/bblfshd</pre></div>
<p>On macOS, use this command instead to use a Docker volume:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd \
  -p 9432:9432 \
  -v bblfsh-storage:/var/lib/bblfshd bblfsh/bblfshd \
  -v /proc:/newproc \
  --security-opt seccomp=./bblfshd-seccomp.json \
  bblfsh/bblfshd</pre></div>
<p>To understand the flags <code>-v /proc:/newproc</code> and <code>--security-opt seccomp=./bblfshd-seccomp.json</code>,
where <a href="./bblfshd-seccomp.json"><code>bblfshd-seccomp.json</code></a> is a file present in this repo, and check
further requirements, please refer to <a href="./rootless.md">rootless.md</a>. <code>bblfshd</code> is based on
<a href="https://github.com/opencontainers/runc/tree/master/libcontainer">container technology</a>
and interacts with the kernel at a low level. It exposes a gRPC server at the port <code>9432</code> by default
which is used by the <a href="https://github.com/search?q=topic%3Aclient+org%3Abblfsh&amp;type=Repositories">clients</a>
to interact with the server. Also, we mount the path <code>/var/lib/bblfshd/</code> where
all the driver images and container instances will be stored.</p>
<h4><a id="user-content-privileged-mode" class="anchor" aria-hidden="true" href="#privileged-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Privileged mode</h4>
<p>We advise against it, but if you prefer to run <code>bblfshd</code> in <code>privileged</code> mode to skip configuration steps of
<a href="rootless.md">rootless.md</a>, you could do, in Linux:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd --privileged -p 9432:9432 -v /var/lib/bblfshd:/var/lib/bblfshd bblfsh/bblfshd</pre></div>
<p>or macOs:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd --privileged -p 9432:9432 -v bblfsh-storage:/var/lib/bblfshd bblfsh/bblfshd</pre></div>
<h4><a id="user-content-install-drivers" class="anchor" aria-hidden="true" href="#install-drivers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install drivers</h4>
<p>Now you need to install the driver images into the daemon, you can install
the official images just running the command:</p>
<div class="highlight highlight-source-shell"><pre>docker <span class="pl-c1">exec</span> -it bblfshd bblfshctl driver install --all</pre></div>
<p>You can check the installed versions by executing:</p>
<pre><code>docker exec -it bblfshd bblfshctl driver list
</code></pre>
<pre><code>+----------+-------------------------------+---------+--------+---------+-----+-------------+
| LANGUAGE |             IMAGE             | VERSION | STATUS | CREATED | GO  |   NATIVE    |
+----------+-------------------------------+---------+--------+---------+-----+-------------+
| python   | //bblfsh/python-driver:latest | v1.1.5  | beta   | 4 days  | 1.8 | 3.6.2       |
| java     | //bblfsh/java-driver:latest   | v1.1.0  | alpha  | 6 days  | 1.8 | 8.131.11-r2 |
+----------+-------------------------------+---------+--------+---------+-----+-------------+
</code></pre>
<p>To test the driver you can execute a parse request to the server with the <code>bblfshctl parse</code> command,
and an example contained in the Docker image:</p>
<div class="highlight highlight-source-shell"><pre>docker <span class="pl-c1">exec</span> -it bblfshd bblfshctl parse /opt/bblfsh/etc/examples/python.py</pre></div>
<h2><a id="user-content-selinux" class="anchor" aria-hidden="true" href="#selinux"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SELinux</h2>
<p>If your system has SELinux enabled (which is the default in Fedora, Red Hat, CentOS
and many others) you'll need to compile and load a policy module before running the
bblfshd Docker image or running driver containers will fail with a <code>permission denied</code> message in the logs.</p>
<p>To do this, run these commands from the project root:</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-c1">cd</span> selinux/
sh compile.sh
semodule -i bblfshd.pp</pre></div>
<p>If you were already running an instance of <em>bblfshd</em>, you will need to delete the
container (<code>docker rm -f bblfshd</code>) and run it again (<code>docker run...</code>).</p>
<p>Once the module has been loaded with <code>semodule</code> the change should persist even
if you reboot. If you want to permanently remove this module run <code>semodule -d bblfshd</code>.</p>
<p>Alternatively, you could set SELinux to permissive module with:</p>
<pre><code>echo 1 &gt; /sys/fs/selinux/enforce
</code></pre>
<p>(doing this on production systems which usually have SELinux enabled by default
should be strongly discouraged).</p>
<h2><a id="user-content-development" class="anchor" aria-hidden="true" href="#development"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Development</h2>
<p>If you wish to work on <em>bblfshd</em> , you'll first need <a href="http://www.golang.org" rel="nofollow">Go</a>
installed on your machine (version 1.11+ is <em>required</em>) and <a href="https://docs.docker.com/engine/installation/" rel="nofollow">Docker</a>.
Docker is used to build and run tests in an isolated environment.</p>
<p>For local development of <em>bblfshd</em>, first make sure Go is properly installed and
that a <a href="http://golang.org/doc/code.html#GOPATH" rel="nofollow">GOPATH</a> has been set. You will
also need to add <code>$GOPATH/bin</code> to your <code>$PATH</code>.</p>
<p>Next, using <a href="https://git-scm.com/" rel="nofollow">Git</a>, clone this repository into
<code>$GOPATH/src/github.com/bblfsh/bblfshd</code>. All the necessary dependencies are
automatically installed, so you just need to type <code>make</code>. This will compile the
code and then run the tests. If this exits with exit status 0, then everything
is working!</p>
<h3><a id="user-content-dependencies" class="anchor" aria-hidden="true" href="#dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependencies</h3>
<p>Ensure you have <a href="https://github.com/ostreedev/ostree"><code>ostree</code></a> and development libraries for <code>ostree</code> installed.</p>
<p>You can install from your distribution pack manager as follow, or built <a href="https://github.com/ostreedev/ostree">from source</a> (more on that <a href="https://ostree.readthedocs.io/en/latest/#building" rel="nofollow">here</a>).</p>
<p>Debian, Ubuntu, and related distributions:</p>
<pre><code>$ apt-get install libostree-dev
</code></pre>
<p>Fedora, CentOS, RHEL, and related distributions:</p>
<div class="highlight highlight-source-shell"><pre>$ yum install -y ostree-devel</pre></div>
<p>Arch and related distributions:</p>
<div class="highlight highlight-source-shell"><pre>$ pacman -S ostree</pre></div>
<h3><a id="user-content-building-from-source" class="anchor" aria-hidden="true" href="#building-from-source"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building From Source</h3>
<p>Build with:</p>
<pre><code>$ make build
</code></pre>
<h3><a id="user-content-running-tests" class="anchor" aria-hidden="true" href="#running-tests"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Tests</h3>
<p>Run tests with:</p>
<pre><code>$ make test
</code></pre>
<h3><a id="user-content-environment-variables" class="anchor" aria-hidden="true" href="#environment-variables"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Environment variables</h3>
<ul>
<li>
<p><code>BBLFSHD_MAX_DRIVER_INSTANCES</code> - maximal number of driver instances for each language.
Default to a number of CPUs.</p>
</li>
<li>
<p><code>BBLFSHD_MIN_DRIVER_INSTANCES</code> - minimal number of driver instances that will be run
for each language. Default to 1.</p>
</li>
</ul>
<h3><a id="user-content-enable-tracing" class="anchor" aria-hidden="true" href="#enable-tracing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enable tracing</h3>
<p>Bblfshd supports <a href="https://opentracing.io/" rel="nofollow">OpenTracing</a> that can be used to profile request on a high level or trace
individual requests to bblfshd and/or language drivers.</p>
<p>To enable it, you can use <a href="https://www.jaegertracing.io/docs/1.8/getting-started/" rel="nofollow">Jaeger</a>.
The easiest way is to start all-in-one Jaeger image:</p>
<pre><code>docker run -d --name jaeger \
  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.8
</code></pre>
<p>For Docker installation of bblfshd add the following flags:</p>
<pre><code>--link jaeger:jaeger -e JAEGER_AGENT_HOST=jaeger -e JAEGER_AGENT_PORT=6831 -e JAEGER_SAMPLER_TYPE=const -e JAEGER_SAMPLER_PARAM=1
</code></pre>
<p>For bblfshd running locally, set following environment variables:</p>
<pre><code>JAEGER_AGENT_HOST=localhost JAEGER_AGENT_PORT=6831 JAEGER_SAMPLER_TYPE=const JAEGER_SAMPLER_PARAM=1
</code></pre>
<p>Run few requests, and check traces at <a href="http://localhost:16686" rel="nofollow">http://localhost:16686</a>.</p>
<p>For enabling tracing in production, consult <a href="https://www.jaegertracing.io/docs/1.8" rel="nofollow">Jaeger documentation</a>.</p>
<h2><a id="user-content-license" class="anchor" aria-hidden="true" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>License</h2>
<p>GPLv3, see <a href="LICENSE">LICENSE</a></p>
</article></div>
<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-bblfshd----" class="anchor" aria-hidden="true" href="#bblfshd----"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bblfshd <a href="https://travis-ci.org/bblfsh/bblfshd" rel="nofollow"><img src="https://camo.githubusercontent.com/b8b5335b39303163a8164a4cb829d7b6137ce015/68747470733a2f2f7472617669732d63692e6f72672f62626c6673682f62626c667368642e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/bblfsh/bblfshd.svg?branch=master" style="max-width:100%;"></a> <a href="https://codecov.io/gh/bblfsh/bblfshd" rel="nofollow"><img src="https://camo.githubusercontent.com/4b59b56e17cf97225bcd4f0ae2a42d9b3fd2a642/68747470733a2f2f636f6465636f762e696f2f67682f62626c6673682f62626c667368642f6272616e63682f6d61737465722f67726170682f62616467652e737667" alt="codecov" data-canonical-src="https://codecov.io/gh/bblfsh/bblfshd/branch/master/graph/badge.svg" style="max-width:100%;"></a> <a href="https://github.com/bblfsh/bblfshd/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/e7264ef0474c6b493d24d9a505e63d20c63b4000/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d47504c2d2d332e302d626c75652e737667" alt="license" data-canonical-src="https://img.shields.io/badge/license-GPL--3.0-blue.svg" style="max-width:100%;"></a> <a href="https://github.com/bblfsh/bblfshd/releases"><img src="https://camo.githubusercontent.com/5629305aee577f54acea3526361f7da9c422af2c/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652f62626c6673682f62626c667368642e737667" alt="GitHub release" data-canonical-src="https://img.shields.io/github/release/bblfsh/bblfshd.svg" style="max-width:100%;"></a></h1>
<p>This repository contains bblfsh daemon (<em>bblfshd</em>), which includes the
runtime that runs the driver in <em>containers</em> and the bblfshctl, a cli tool used
to control the installed drivers and query the status of the daemon.</p>
<p>Drivers are implemented as Docker images, each having their own repository in the
<a href="https://github.com/search?q=topic%3Adriver+org%3Abblfsh&amp;type=Repositories"><code>bblfsh</code> organization</a>
on GitHub. For more information, see <a href="https://doc.bblf.sh/writing-a-driver/babelfish-sdk.html" rel="nofollow">bblfsh SDK documentation</a>.</p>
<h2><a id="user-content-getting-started" class="anchor" aria-hidden="true" href="#getting-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting Started</h2>
<p>See the <a href="https://doc.bblf.sh/using-babelfish/getting-started.html" rel="nofollow">Getting Started</a> guide.</p>
<h3><a id="user-content-quick-start" class="anchor" aria-hidden="true" href="#quick-start"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Quick start</h3>
<p>This project is now part of <a href="https://sourced.tech/engine" rel="nofollow">source{d} Engine</a>,
which provides the simplest way to get started with a single command.
Visit <a href="https://sourced.tech/engine" rel="nofollow">sourced.tech/engine</a> for more information.</p>
<h4><a id="user-content-rootless-mode" class="anchor" aria-hidden="true" href="#rootless-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rootless mode</h4>
<p>The recommended way to run <em>bblfshd</em> by itself is using Docker:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd \
  -p 9432:9432 \
  -v /var/lib/bblfshd:/var/lib/bblfshd \
  -v /proc:/newproc \
  --security-opt seccomp=./bblfshd-seccomp.json \
  bblfsh/bblfshd</pre></div>
<p>On macOS, use this command instead to use a Docker volume:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd \
  -p 9432:9432 \
  -v bblfsh-storage:/var/lib/bblfshd bblfsh/bblfshd \
  -v /proc:/newproc \
  --security-opt seccomp=./bblfshd-seccomp.json \
  bblfsh/bblfshd</pre></div>
<p>To understand the flags <code>-v /proc:/newproc</code> and <code>--security-opt seccomp=./bblfshd-seccomp.json</code>,
where <a href="./bblfshd-seccomp.json"><code>bblfshd-seccomp.json</code></a> is a file present in this repo, and check
further requirements, please refer to <a href="./rootless.md">rootless.md</a>. <code>bblfshd</code> is based on
<a href="https://github.com/opencontainers/runc/tree/master/libcontainer">container technology</a>
and interacts with the kernel at a low level. It exposes a gRPC server at the port <code>9432</code> by default
which is used by the <a href="https://github.com/search?q=topic%3Aclient+org%3Abblfsh&amp;type=Repositories">clients</a>
to interact with the server. Also, we mount the path <code>/var/lib/bblfshd/</code> where
all the driver images and container instances will be stored.</p>
<h4><a id="user-content-privileged-mode" class="anchor" aria-hidden="true" href="#privileged-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Privileged mode</h4>
<p>We advise against it, but if you prefer to run <code>bblfshd</code> in <code>privileged</code> mode to skip configuration steps of
<a href="rootless.md">rootless.md</a>, you could do, in Linux:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd --privileged -p 9432:9432 -v /var/lib/bblfshd:/var/lib/bblfshd bblfsh/bblfshd</pre></div>
<p>or macOs:</p>
<div class="highlight highlight-source-shell"><pre>docker run -d --name bblfshd --privileged -p 9432:9432 -v bblfsh-storage:/var/lib/bblfshd bblfsh/bblfshd</pre></div>
<h4><a id="user-content-install-drivers" class="anchor" aria-hidden="true" href="#install-drivers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install drivers</h4>
<p>Now you need to install the driver images into the daemon, you can install
the official images just running the command:</p>
<div class="highlight highlight-source-shell"><pre>docker <span class="pl-c1">exec</span> -it bblfshd bblfshctl driver install --all</pre></div>
<p>You can check the installed versions by executing:</p>
<pre><code>docker exec -it bblfshd bblfshctl driver list
</code></pre>
<pre><code>+----------+-------------------------------+---------+--------+---------+-----+-------------+
| LANGUAGE |             IMAGE             | VERSION | STATUS | CREATED | GO  |   NATIVE    |
+----------+-------------------------------+---------+--------+---------+-----+-------------+
| python   | //bblfsh/python-driver:latest | v1.1.5  | beta   | 4 days  | 1.8 | 3.6.2       |
| java     | //bblfsh/java-driver:latest   | v1.1.0  | alpha  | 6 days  | 1.8 | 8.131.11-r2 |
+----------+-------------------------------+---------+--------+---------+-----+-------------+
</code></pre>
<p>To test the driver you can execute a parse request to the server with the <code>bblfshctl parse</code> command,
and an example contained in the Docker image:</p>
<div class="highlight highlight-source-shell"><pre>docker <span class="pl-c1">exec</span> -it bblfshd bblfshctl parse /opt/bblfsh/etc/examples/python.py</pre></div>
<h2><a id="user-content-selinux" class="anchor" aria-hidden="true" href="#selinux"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SELinux</h2>
<p>If your system has SELinux enabled (which is the default in Fedora, Red Hat, CentOS
and many others) you'll need to compile and load a policy module before running the
bblfshd Docker image or running driver containers will fail with a <code>permission denied</code> message in the logs.</p>
<p>To do this, run these commands from the project root:</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-c1">cd</span> selinux/
sh compile.sh
semodule -i bblfshd.pp</pre></div>
<p>If you were already running an instance of <em>bblfshd</em>, you will need to delete the
container (<code>docker rm -f bblfshd</code>) and run it again (<code>docker run...</code>).</p>
<p>Once the module has been loaded with <code>semodule</code> the change should persist even
if you reboot. If you want to permanently remove this module run <code>semodule -d bblfshd</code>.</p>
<p>Alternatively, you could set SELinux to permissive module with:</p>
<pre><code>echo 1 &gt; /sys/fs/selinux/enforce
</code></pre>
<p>(doing this on production systems which usually have SELinux enabled by default
should be strongly discouraged).</p>
<h2><a id="user-content-development" class="anchor" aria-hidden="true" href="#development"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Development</h2>
<p>If you wish to work on <em>bblfshd</em> , you'll first need <a href="http://www.golang.org" rel="nofollow">Go</a>
installed on your machine (version 1.11+ is <em>required</em>) and <a href="https://docs.docker.com/engine/installation/" rel="nofollow">Docker</a>.
Docker is used to build and run tests in an isolated environment.</p>
<p>For local development of <em>bblfshd</em>, first make sure Go is properly installed and
that a <a href="http://golang.org/doc/code.html#GOPATH" rel="nofollow">GOPATH</a> has been set. You will
also need to add <code>$GOPATH/bin</code> to your <code>$PATH</code>.</p>
<p>Next, using <a href="https://git-scm.com/" rel="nofollow">Git</a>, clone this repository into
<code>$GOPATH/src/github.com/bblfsh/bblfshd</code>. All the necessary dependencies are
automatically installed, so you just need to type <code>make</code>. This will compile the
code and then run the tests. If this exits with exit status 0, then everything
is working!</p>
<h3><a id="user-content-dependencies" class="anchor" aria-hidden="true" href="#dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependencies</h3>
<p>Ensure you have <a href="https://github.com/ostreedev/ostree"><code>ostree</code></a> and development libraries for <code>ostree</code> installed.</p>
<p>You can install from your distribution pack manager as follow, or built <a href="https://github.com/ostreedev/ostree">from source</a> (more on that <a href="https://ostree.readthedocs.io/en/latest/#building" rel="nofollow">here</a>).</p>
<p>Debian, Ubuntu, and related distributions:</p>
<pre><code>$ apt-get install libostree-dev
</code></pre>
<p>Fedora, CentOS, RHEL, and related distributions:</p>
<div class="highlight highlight-source-shell"><pre>$ yum install -y ostree-devel</pre></div>
<p>Arch and related distributions:</p>
<div class="highlight highlight-source-shell"><pre>$ pacman -S ostree</pre></div>
<h3><a id="user-content-building-from-source" class="anchor" aria-hidden="true" href="#building-from-source"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building From Source</h3>
<p>Build with:</p>
<pre><code>$ make build
</code></pre>
<h3><a id="user-content-running-tests" class="anchor" aria-hidden="true" href="#running-tests"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Tests</h3>
<p>Run tests with:</p>
<pre><code>$ make test
</code></pre>
<h3><a id="user-content-environment-variables" class="anchor" aria-hidden="true" href="#environment-variables"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Environment variables</h3>
<ul>
<li>
<p><code>BBLFSHD_MAX_DRIVER_INSTANCES</code> - maximal number of driver instances for each language.
Default to a number of CPUs.</p>
</li>
<li>
<p><code>BBLFSHD_MIN_DRIVER_INSTANCES</code> - minimal number of driver instances that will be run
for each language. Default to 1.</p>
</li>
</ul>
<h3><a id="user-content-enable-tracing" class="anchor" aria-hidden="true" href="#enable-tracing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enable tracing</h3>
<p>Bblfshd supports <a href="https://opentracing.io/" rel="nofollow">OpenTracing</a> that can be used to profile request on a high level or trace
individual requests to bblfshd and/or language drivers.</p>
<p>To enable it, you can use <a href="https://www.jaegertracing.io/docs/1.8/getting-started/" rel="nofollow">Jaeger</a>.
The easiest way is to start all-in-one Jaeger image:</p>
<pre><code>docker run -d --name jaeger \
  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.8
</code></pre>
<p>For Docker installation of bblfshd add the following flags:</p>
<pre><code>--link jaeger:jaeger -e JAEGER_AGENT_HOST=jaeger -e JAEGER_AGENT_PORT=6831 -e JAEGER_SAMPLER_TYPE=const -e JAEGER_SAMPLER_PARAM=1
</code></pre>
<p>For bblfshd running locally, set following environment variables:</p>
<pre><code>JAEGER_AGENT_HOST=localhost JAEGER_AGENT_PORT=6831 JAEGER_SAMPLER_TYPE=const JAEGER_SAMPLER_PARAM=1
</code></pre>
<p>Run few requests, and check traces at <a href="http://localhost:16686" rel="nofollow">http://localhost:16686</a>.</p>
<p>For enabling tracing in production, consult <a href="https://www.jaegertracing.io/docs/1.8" rel="nofollow">Jaeger documentation</a>.</p>
<h2><a id="user-content-license" class="anchor" aria-hidden="true" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>License</h2>
<p>GPLv3, see <a href="LICENSE">LICENSE</a></p>
</article></div>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 15 May 2020</div><div class="column">Version: 1.3.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>