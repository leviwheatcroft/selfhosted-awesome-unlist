<!DOCTYPE html><html><head><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Self-hosted server for source code parsing. It can parse any file, in any supported language, extract an Abstract Syntax Tree from it, and convert it to a Universal Abstract Syntax Tree which can enable further analysis and transformation."><meta name="DCTERMS.issued"><meta name="DCTERMS.modified"><title></title><link href="https://fonts.googleapis.com/css2?family=Special+Elite&amp;display=swap" rel="stylesheet"><link href="/selfhosted-awesome-unlist/site.css" rel="stylesheet" type="text/css"></head></head><body><nav class="navigation"><section class="container"><a class="navigation-title" href="/selfhosted-awesome-unlist/">Selfhosted Awesome [Un]list</a></section></nav><header><div class="container"><div class="row"><div class="column"><div class="title"><h1>bblfshd</h1></div></div></div></div></header><section><div class="container"><div class="row"><div class="column"><div class="info"><div class="github"><span class="pushed-at"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg>07 Nov 2019</span><span class="stargazers-count"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>269</span><span class="issues"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>30</span></div><div class="tags"><a class="button" href="/selfhosted-awesome-unlist/tags/software-development.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Software Development</a><a class="button" href="/selfhosted-awesome-unlist/tags/selfhosted.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>selfhosted</a><a class="button" href="/selfhosted-awesome-unlist/tags/docker.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>Docker</a></div></div></div></div></div></section><article><div class="container"><div class="row"><div class="column"><h1 id="bblfshd-build-status-codecov-license-github-release">bblfshd <a href="https://travis-ci.org/bblfsh/bblfshd"><img src="https://travis-ci.org/bblfsh/bblfshd.svg?branch=master" alt="Build Status"></a> <a href="https://codecov.io/gh/bblfsh/bblfshd"><img src="https://codecov.io/gh/bblfsh/bblfshd/branch/master/graph/badge.svg" alt="codecov"></a> <a href="https://github.com/bblfsh/bblfshd/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-GPL--3.0-blue.svg" alt="license"></a> <a href="https://github.com/bblfsh/bblfshd/releases"><img src="https://img.shields.io/github/release/bblfsh/bblfshd.svg" alt="GitHub release"></a></h1>
<p>This repository contains bblfsh daemon (<em>bblfshd</em>), which includes the
runtime that runs the driver in <em>containers</em> and the bblfshctl, a cli tool used
to control the installed drivers and query the status of the daemon.</p>
<p>Drivers are implemented as Docker images, each having their own repository in the 
<a href="https://github.com/search?q=topic%3Adriver+org%3Abblfsh&amp;type=Repositories"><code>bblfsh</code> organization</a>
on GitHub. For more information, see <a href="https://doc.bblf.sh/writing-a-driver/babelfish-sdk.html">bblfsh SDK documentation</a>.</p>
<h2 id="getting-started">Getting Started</h2>
<p>See the <a href="https://doc.bblf.sh/using-babelfish/getting-started.html">Getting Started</a> guide.</p>
<h3 id="quick-start">Quick start</h3>
<p>This project is now part of <a href="https://sourced.tech/engine">source{d} Engine</a>,
which provides the simplest way to get started with a single command.
Visit <a href="https://sourced.tech/engine">sourced.tech/engine</a> for more information.</p>
<h4 id="rootless-mode">Rootless mode</h4>
<p>The recommended way to run <em>bblfshd</em> by itself is using Docker:</p>
<pre><code class="language-sh">docker run -d --name bblfshd \
  -p 9432:9432 \
  -v /var/lib/bblfshd:/var/lib/bblfshd \
  -v /proc:/newproc \
  --security-opt seccomp=./bblfshd-seccomp.json \
  bblfsh/bblfshd</code></pre>
<p>On macOS, use this command instead to use a Docker volume:</p>
<pre><code class="language-sh">docker run -d --name bblfshd \
  -p 9432:9432 \
  -v bblfsh-storage:/var/lib/bblfshd bblfsh/bblfshd \
  -v /proc:/newproc \
  --security-opt seccomp=./bblfshd-seccomp.json \
  bblfsh/bblfshd</code></pre>
<p>To understand the flags <code>-v /proc:/newproc</code> and <code>--security-opt seccomp=./bblfshd-seccomp.json</code>, 
where <a href="./bblfshd-seccomp.json"><code>bblfshd-seccomp.json</code></a> is a file present in this repo, and check 
further requirements, please refer to <a href="./rootless.md">rootless.md</a>. <code>bblfshd</code> is based on 
<a href="https://github.com/opencontainers/runc/tree/master/libcontainer">container technology</a>
and interacts with the kernel at a low level. It exposes a gRPC server at the port <code>9432</code> by default 
which is used by the <a href="https://github.com/search?q=topic%3Aclient+org%3Abblfsh&amp;type=Repositories">clients</a>
to interact with the server. Also, we mount the path <code>/var/lib/bblfshd/</code> where
all the driver images and container instances will be stored.</p>
<h4 id="privileged-mode">Privileged mode</h4>
<p>We advise against it, but if you prefer to run <code>bblfshd</code> in <code>privileged</code> mode to skip configuration steps of 
<a href="rootless.md">rootless.md</a>, you could do, in Linux:</p>
<pre><code class="language-sh">docker run -d --name bblfshd --privileged -p 9432:9432 -v /var/lib/bblfshd:/var/lib/bblfshd bblfsh/bblfshd</code></pre>
<p>or macOs:</p>
<pre><code class="language-sh">docker run -d --name bblfshd --privileged -p 9432:9432 -v bblfsh-storage:/var/lib/bblfshd bblfsh/bblfshd</code></pre>
<h4 id="install-drivers">Install drivers</h4>
<p>Now you need to install the driver images into the daemon, you can install
the official images just running the command:</p>
<pre><code class="language-sh">docker exec -it bblfshd bblfshctl driver install --all</code></pre>
<p>You can check the installed versions by executing:</p>
<pre><code>docker exec -it bblfshd bblfshctl driver list</code></pre><pre><code>+----------+-------------------------------+---------+--------+---------+-----+-------------+
| LANGUAGE |             IMAGE             | VERSION | STATUS | CREATED | GO  |   NATIVE    |
+----------+-------------------------------+---------+--------+---------+-----+-------------+
| python   | //bblfsh/python-driver:latest | v1.1.5  | beta   | 4 days  | 1.8 | 3.6.2       |
| java     | //bblfsh/java-driver:latest   | v1.1.0  | alpha  | 6 days  | 1.8 | 8.131.11-r2 |
+----------+-------------------------------+---------+--------+---------+-----+-------------+</code></pre><p>To test the driver you can execute a parse request to the server with the <code>bblfshctl parse</code> command,
and an example contained in the Docker image:</p>
<pre><code class="language-sh">docker exec -it bblfshd bblfshctl parse /opt/bblfsh/etc/examples/python.py</code></pre>
<h2 id="selinux">SELinux</h2>
<p>If your system has SELinux enabled (which is the default in Fedora, Red Hat, CentOS
and many others) you&#39;ll need to compile and load a policy module before running the
bblfshd Docker image or running driver containers will fail with a <code>permission
denied</code> message in the logs. </p>
<p>To do this, run these commands from the project root:</p>
<pre><code class="language-bash">cd selinux/
sh compile.sh
semodule -i bblfshd.pp</code></pre>
<p>If you were already running an instance of <em>bblfshd</em>, you will need to delete the
container (<code>docker rm -f bblfshd</code>) and run it again (<code>docker run...</code>).</p>
<p>Once the module has been loaded with <code>semodule</code> the change should persist even
if you reboot. If you want to permanently remove this module run <code>semodule -d bblfshd</code>.</p>
<p>Alternatively, you could set SELinux to permissive module with:</p>
<pre><code>echo 1 &gt; /sys/fs/selinux/enforce</code></pre><p>(doing this on production systems which usually have SELinux enabled by default
should be strongly discouraged).</p>
<h2 id="development">Development</h2>
<p>If you wish to work on <em>bblfshd</em> , you&#39;ll first need <a href="http://www.golang.org">Go</a>
installed on your machine (version 1.11+ is <em>required</em>) and <a href="https://docs.docker.com/engine/installation/">Docker</a>.
Docker is used to build and run tests in an isolated environment.</p>
<p>For local development of <em>bblfshd</em>, first make sure Go is properly installed and
that a <a href="http://golang.org/doc/code.html#GOPATH">GOPATH</a> has been set. You will
 also need to add <code>$GOPATH/bin</code> to your <code>$PATH</code>.</p>
<p>Next, using <a href="https://git-scm.com/">Git</a>, clone this repository into
<code>$GOPATH/src/github.com/bblfsh/bblfshd</code>. All the necessary dependencies are
automatically installed, so you just need to type <code>make</code>. This will compile the
code and then run the tests. If this exits with exit status 0, then everything
is working!</p>
<h3 id="dependencies">Dependencies</h3>
<p>Ensure you have <a href="https://github.com/ostreedev/ostree"><code>ostree</code></a> and development libraries for <code>ostree</code> installed.</p>
<p>You can install from your distribution pack manager as follow, or built <a href="https://github.com/ostreedev/ostree">from source</a> (more on that <a href="https://ostree.readthedocs.io/en/latest/#building">here</a>).</p>
<p>Debian, Ubuntu, and related distributions:</p>
<pre><code>$ apt-get install libostree-dev</code></pre><p>Fedora, CentOS, RHEL, and related distributions:</p>
<pre><code class="language-bash">$ yum install -y ostree-devel</code></pre>
<p>Arch and related distributions:</p>
<pre><code class="language-bash">$ pacman -S ostree</code></pre>
<h3 id="building-from-source">Building From Source</h3>
<p>Build with:</p>
<pre><code>$ make build</code></pre><h3 id="running-tests">Running Tests</h3>
<p>Run tests with:</p>
<pre><code>$ make test</code></pre><h3 id="environment-variables">Environment variables</h3>
<ul>
<li><p><code>BBLFSHD_MAX_DRIVER_INSTANCES</code> - maximal number of driver instances for each language.
Default to a number of CPUs.</p>
</li>
<li><p><code>BBLFSHD_MIN_DRIVER_INSTANCES</code> - minimal number of driver instances that will be run
for each language. Default to 1.</p>
</li>
</ul>
<h3 id="enable-tracing">Enable tracing</h3>
<p>Bblfshd supports <a href="https://opentracing.io/">OpenTracing</a> that can be used to profile request on a high level or trace
individual requests to bblfshd and/or language drivers.</p>
<p>To enable it, you can use <a href="https://www.jaegertracing.io/docs/1.8/getting-started/">Jaeger</a>.
The easiest way is to start all-in-one Jaeger image:</p>
<pre><code>docker run -d --name jaeger \
  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.8</code></pre><p>For Docker installation of bblfshd add the following flags:</p>
<pre><code>--link jaeger:jaeger -e JAEGER_AGENT_HOST=jaeger -e JAEGER_AGENT_PORT=6831 -e JAEGER_SAMPLER_TYPE=const -e JAEGER_SAMPLER_PARAM=1</code></pre><p>For bblfshd running locally, set following environment variables:</p>
<pre><code>JAEGER_AGENT_HOST=localhost JAEGER_AGENT_PORT=6831 JAEGER_SAMPLER_TYPE=const JAEGER_SAMPLER_PARAM=1</code></pre><p>Run few requests, and check traces at <a href="http://localhost:16686">http://localhost:16686</a>.</p>
<p>For enabling tracing in production, consult <a href="https://www.jaegertracing.io/docs/1.8">Jaeger documentation</a>.</p>
<h2 id="license">License</h2>
<p>GPLv3, see <a href="LICENSE">LICENSE</a></p>
</div></div></div></article><footer><div class="container"><div class="row"><div class="column">Total Projects: 1313</div><div class="column">Built On: 02 May 2020</div><div class="column">Version: 1.1.0</div></div></div></footer><script src="/selfhosted-awesome-unlist/site.js"></script></body></html>